var Gs=Object.create;var yr=Object.defineProperty;var Js=Object.getOwnPropertyDescriptor;var Ks=Object.getOwnPropertyNames;var Xs=Object.getPrototypeOf,Zs=Object.prototype.hasOwnProperty;var Ft=(o,r)=>()=>(o&&(r=o(o=0)),r);var xr=(o,r)=>()=>(r||o((r={exports:{}}).exports,r),r.exports),Ki=(o,r)=>{for(var n in r)yr(o,n,{get:r[n],enumerable:!0})},Xi=(o,r,n,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of Ks(r))!Zs.call(o,s)&&s!==n&&yr(o,s,{get:()=>r[s],enumerable:!(a=Js(r,s))||a.enumerable});return o};var de=(o,r,n)=>(n=o!=null?Gs(Xs(o)):{},Xi(r||!o||!o.__esModule?yr(n,"default",{value:o,enumerable:!0}):n,o)),el=o=>Xi(yr({},"__esModule",{value:!0}),o);var to=xr((wr,eo)=>{(function(o,r){typeof wr=="object"&&typeof eo<"u"?r(wr):typeof define=="function"&&define.amd?define(["exports"],r):(o=typeof globalThis<"u"?globalThis:o||self,r(o.WebStreamsPolyfill={}))})(wr,function(o){"use strict";function r(){}function n(e){return typeof e=="object"&&e!==null||typeof e=="function"}let a=r;function s(e,t){try{Object.defineProperty(e,"name",{value:t,configurable:!0})}catch{}}let f=Promise,c=Promise.prototype.then,g=Promise.reject.bind(f);function p(e){return new f(e)}function m(e){return p(t=>t(e))}function b(e){return g(e)}function w(e,t,i){return c.call(e,t,i)}function R(e,t,i){w(w(e,t,i),void 0,a)}function E(e,t){R(e,t)}function y(e,t){R(e,void 0,t)}function I(e,t,i){return w(e,t,i)}function A(e){w(e,void 0,a)}let P=e=>{if(typeof queueMicrotask=="function")P=queueMicrotask;else{let t=m(void 0);P=i=>w(t,i)}return P(e)};function q(e,t,i){if(typeof e!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,t,i)}function U(e,t,i){try{return m(q(e,t,i))}catch(l){return b(l)}}let F=16384;class D{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(t){let i=this._back,l=i;i._elements.length===F-1&&(l={_elements:[],_next:void 0}),i._elements.push(t),l!==i&&(this._back=l,i._next=l),++this._size}shift(){let t=this._front,i=t,l=this._cursor,u=l+1,d=t._elements,h=d[l];return u===F&&(i=t._next,u=0),--this._size,this._cursor=u,t!==i&&(this._front=i),d[l]=void 0,h}forEach(t){let i=this._cursor,l=this._front,u=l._elements;for(;(i!==u.length||l._next!==void 0)&&!(i===u.length&&(l=l._next,u=l._elements,i=0,u.length===0));)t(u[i]),++i}peek(){let t=this._front,i=this._cursor;return t._elements[i]}}let O=Symbol("[[AbortSteps]]"),M=Symbol("[[ErrorSteps]]"),ae=Symbol("[[CancelSteps]]"),se=Symbol("[[PullSteps]]"),wt=Symbol("[[ReleaseSteps]]");function Fe(e,t){e._ownerReadableStream=t,t._reader=e,t._state==="readable"?Wr(e):t._state==="closed"?oa(e):qn(e,t._storedError)}function St(e,t){let i=e._ownerReadableStream;return fe(i,t)}function le(e){let t=e._ownerReadableStream;t._state==="readable"?Lr(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):aa(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),t._readableStreamController[wt](),t._reader=void 0,e._ownerReadableStream=void 0}function Ut(e){return new TypeError("Cannot "+e+" a stream using a released reader")}function Wr(e){e._closedPromise=p((t,i)=>{e._closedPromise_resolve=t,e._closedPromise_reject=i})}function qn(e,t){Wr(e),Lr(e,t)}function oa(e){Wr(e),Wn(e)}function Lr(e,t){e._closedPromise_reject!==void 0&&(A(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function aa(e,t){qn(e,t)}function Wn(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}let Ln=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)},sa=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function la(e){return typeof e=="object"||typeof e=="function"}function he(e,t){if(e!==void 0&&!la(e))throw new TypeError(`${t} is not an object.`)}function te(e,t){if(typeof e!="function")throw new TypeError(`${t} is not a function.`)}function ua(e){return typeof e=="object"&&e!==null||typeof e=="function"}function zn(e,t){if(!ua(e))throw new TypeError(`${t} is not an object.`)}function xe(e,t,i){if(e===void 0)throw new TypeError(`Parameter ${t} is required in '${i}'.`)}function zr(e,t,i){if(e===void 0)throw new TypeError(`${t} is required in '${i}'.`)}function jr(e){return Number(e)}function jn(e){return e===0?0:e}function fa(e){return jn(sa(e))}function Mr(e,t){let l=Number.MAX_SAFE_INTEGER,u=Number(e);if(u=jn(u),!Ln(u))throw new TypeError(`${t} is not a finite number`);if(u=fa(u),u<0||u>l)throw new TypeError(`${t} is outside the accepted range of 0 to ${l}, inclusive`);return!Ln(u)||u===0?0:u}function Ur(e,t){if(!ze(e))throw new TypeError(`${t} is not a ReadableStream.`)}function nt(e){return new De(e)}function Mn(e,t){e._reader._readRequests.push(t)}function Nr(e,t,i){let u=e._reader._readRequests.shift();i?u._closeSteps():u._chunkSteps(t)}function Nt(e){return e._reader._readRequests.length}function Un(e){let t=e._reader;return!(t===void 0||!Oe(t))}class De{constructor(t){if(xe(t,1,"ReadableStreamDefaultReader"),Ur(t,"First parameter"),je(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");Fe(this,t),this._readRequests=new D}get closed(){return Oe(this)?this._closedPromise:b($t("closed"))}cancel(t=void 0){return Oe(this)?this._ownerReadableStream===void 0?b(Ut("cancel")):St(this,t):b($t("cancel"))}read(){if(!Oe(this))return b($t("read"));if(this._ownerReadableStream===void 0)return b(Ut("read from"));let t,i,l=p((d,h)=>{t=d,i=h});return _t(this,{_chunkSteps:d=>t({value:d,done:!1}),_closeSteps:()=>t({value:void 0,done:!0}),_errorSteps:d=>i(d)}),l}releaseLock(){if(!Oe(this))throw $t("releaseLock");this._ownerReadableStream!==void 0&&ca(this)}}Object.defineProperties(De.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),s(De.prototype.cancel,"cancel"),s(De.prototype.read,"read"),s(De.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(De.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function Oe(e){return!n(e)||!Object.prototype.hasOwnProperty.call(e,"_readRequests")?!1:e instanceof De}function _t(e,t){let i=e._ownerReadableStream;i._disturbed=!0,i._state==="closed"?t._closeSteps():i._state==="errored"?t._errorSteps(i._storedError):i._readableStreamController[se](t)}function ca(e){le(e);let t=new TypeError("Reader was released");Nn(e,t)}function Nn(e,t){let i=e._readRequests;e._readRequests=new D,i.forEach(l=>{l._errorSteps(t)})}function $t(e){return new TypeError(`ReadableStreamDefaultReader.prototype.${e} can only be used on a ReadableStreamDefaultReader`)}let da=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class $n{constructor(t,i){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=t,this._preventCancel=i}next(){let t=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?I(this._ongoingPromise,t,t):t(),this._ongoingPromise}return(t){let i=()=>this._returnSteps(t);return this._ongoingPromise?I(this._ongoingPromise,i,i):i()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let t=this._reader,i,l,u=p((h,x)=>{i=h,l=x});return _t(t,{_chunkSteps:h=>{this._ongoingPromise=void 0,P(()=>i({value:h,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,le(t),i({value:void 0,done:!0})},_errorSteps:h=>{this._ongoingPromise=void 0,this._isFinished=!0,le(t),l(h)}}),u}_returnSteps(t){if(this._isFinished)return Promise.resolve({value:t,done:!0});this._isFinished=!0;let i=this._reader;if(!this._preventCancel){let l=St(i,t);return le(i),I(l,()=>({value:t,done:!0}))}return le(i),m({value:t,done:!0})}}let Hn={next(){return Vn(this)?this._asyncIteratorImpl.next():b(Yn("next"))},return(e){return Vn(this)?this._asyncIteratorImpl.return(e):b(Yn("return"))}};Object.setPrototypeOf(Hn,da);function ma(e,t){let i=nt(e),l=new $n(i,t),u=Object.create(Hn);return u._asyncIteratorImpl=l,u}function Vn(e){if(!n(e)||!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorImpl"))return!1;try{return e._asyncIteratorImpl instanceof $n}catch{return!1}}function Yn(e){return new TypeError(`ReadableStreamAsyncIterator.${e} can only be used on a ReadableSteamAsyncIterator`)}let Qn=Number.isNaN||function(e){return e!==e};var $r,Hr,Vr;function Rt(e){return e.slice()}function Gn(e,t,i,l,u){new Uint8Array(e).set(new Uint8Array(i,l,u),t)}let we=e=>(typeof e.transfer=="function"?we=t=>t.transfer():typeof structuredClone=="function"?we=t=>structuredClone(t,{transfer:[t]}):we=t=>t,we(e)),Ie=e=>(typeof e.detached=="boolean"?Ie=t=>t.detached:Ie=t=>t.byteLength===0,Ie(e));function Jn(e,t,i){if(e.slice)return e.slice(t,i);let l=i-t,u=new ArrayBuffer(l);return Gn(u,0,e,t,l),u}function Ht(e,t){let i=e[t];if(i!=null){if(typeof i!="function")throw new TypeError(`${String(t)} is not a function`);return i}}function ha(e){let t={[Symbol.iterator]:()=>e.iterator},i=async function*(){return yield*t}(),l=i.next;return{iterator:i,nextMethod:l,done:!1}}let Yr=(Vr=($r=Symbol.asyncIterator)!==null&&$r!==void 0?$r:(Hr=Symbol.for)===null||Hr===void 0?void 0:Hr.call(Symbol,"Symbol.asyncIterator"))!==null&&Vr!==void 0?Vr:"@@asyncIterator";function Kn(e,t="sync",i){if(i===void 0)if(t==="async"){if(i=Ht(e,Yr),i===void 0){let d=Ht(e,Symbol.iterator),h=Kn(e,"sync",d);return ha(h)}}else i=Ht(e,Symbol.iterator);if(i===void 0)throw new TypeError("The object is not iterable");let l=q(i,e,[]);if(!n(l))throw new TypeError("The iterator method must return an object");let u=l.next;return{iterator:l,nextMethod:u,done:!1}}function pa(e){let t=q(e.nextMethod,e.iterator,[]);if(!n(t))throw new TypeError("The iterator.next() method must return an object");return t}function ba(e){return!!e.done}function ga(e){return e.value}function ya(e){return!(typeof e!="number"||Qn(e)||e<0)}function Xn(e){let t=Jn(e.buffer,e.byteOffset,e.byteOffset+e.byteLength);return new Uint8Array(t)}function Qr(e){let t=e._queue.shift();return e._queueTotalSize-=t.size,e._queueTotalSize<0&&(e._queueTotalSize=0),t.value}function Gr(e,t,i){if(!ya(i)||i===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:t,size:i}),e._queueTotalSize+=i}function xa(e){return e._queue.peek().value}function qe(e){e._queue=new D,e._queueTotalSize=0}function Zn(e){return e===DataView}function wa(e){return Zn(e.constructor)}function Sa(e){return Zn(e)?1:e.BYTES_PER_ELEMENT}class $e{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!Jr(this))throw tn("view");return this._view}respond(t){if(!Jr(this))throw tn("respond");if(xe(t,1,"respond"),t=Mr(t,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Ie(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");Gt(this._associatedReadableByteStreamController,t)}respondWithNewView(t){if(!Jr(this))throw tn("respondWithNewView");if(xe(t,1,"respondWithNewView"),!ArrayBuffer.isView(t))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Ie(t.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");Jt(this._associatedReadableByteStreamController,t)}}Object.defineProperties($e.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),s($e.prototype.respond,"respond"),s($e.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty($e.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class Se{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!He(this))throw Et("byobRequest");return en(this)}get desiredSize(){if(!He(this))throw Et("desiredSize");return ui(this)}close(){if(!He(this))throw Et("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let t=this._controlledReadableByteStream._state;if(t!=="readable")throw new TypeError(`The stream (in ${t} state) is not in the readable state and cannot be closed`);Tt(this)}enqueue(t){if(!He(this))throw Et("enqueue");if(xe(t,1,"enqueue"),!ArrayBuffer.isView(t))throw new TypeError("chunk must be an array buffer view");if(t.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(t.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let i=this._controlledReadableByteStream._state;if(i!=="readable")throw new TypeError(`The stream (in ${i} state) is not in the readable state and cannot be enqueued to`);Qt(this,t)}error(t=void 0){if(!He(this))throw Et("error");re(this,t)}[ae](t){ei(this),qe(this);let i=this._cancelAlgorithm(t);return Yt(this),i}[se](t){let i=this._controlledReadableByteStream;if(this._queueTotalSize>0){li(this,t);return}let l=this._autoAllocateChunkSize;if(l!==void 0){let u;try{u=new ArrayBuffer(l)}catch(h){t._errorSteps(h);return}let d={buffer:u,bufferByteLength:l,byteOffset:0,byteLength:l,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(d)}Mn(i,t),Ve(this)}[wt](){if(this._pendingPullIntos.length>0){let t=this._pendingPullIntos.peek();t.readerType="none",this._pendingPullIntos=new D,this._pendingPullIntos.push(t)}}}Object.defineProperties(Se.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),s(Se.prototype.close,"close"),s(Se.prototype.enqueue,"enqueue"),s(Se.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Se.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function He(e){return!n(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")?!1:e instanceof Se}function Jr(e){return!n(e)||!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")?!1:e instanceof $e}function Ve(e){if(!ka(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;let i=e._pullAlgorithm();R(i,()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,Ve(e)),null),l=>(re(e,l),null))}function ei(e){Xr(e),e._pendingPullIntos=new D}function Kr(e,t){let i=!1;e._state==="closed"&&(i=!0);let l=ti(t);t.readerType==="default"?Nr(e,l,i):Fa(e,l,i)}function ti(e){let t=e.bytesFilled,i=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,t/i)}function Vt(e,t,i,l){e._queue.push({buffer:t,byteOffset:i,byteLength:l}),e._queueTotalSize+=l}function ri(e,t,i,l){let u;try{u=Jn(t,i,i+l)}catch(d){throw re(e,d),d}Vt(e,u,0,l)}function ni(e,t){t.bytesFilled>0&&ri(e,t.buffer,t.byteOffset,t.bytesFilled),it(e)}function ii(e,t){let i=Math.min(e._queueTotalSize,t.byteLength-t.bytesFilled),l=t.bytesFilled+i,u=i,d=!1,h=l%t.elementSize,x=l-h;x>=t.minimumFill&&(u=x-t.bytesFilled,d=!0);let T=e._queue;for(;u>0;){let S=T.peek(),k=Math.min(u,S.byteLength),v=t.byteOffset+t.bytesFilled;Gn(t.buffer,v,S.buffer,S.byteOffset,k),S.byteLength===k?T.shift():(S.byteOffset+=k,S.byteLength-=k),e._queueTotalSize-=k,oi(e,k,t),u-=k}return d}function oi(e,t,i){i.bytesFilled+=t}function ai(e){e._queueTotalSize===0&&e._closeRequested?(Yt(e),Bt(e._controlledReadableByteStream)):Ve(e)}function Xr(e){e._byobRequest!==null&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function Zr(e){for(;e._pendingPullIntos.length>0;){if(e._queueTotalSize===0)return;let t=e._pendingPullIntos.peek();ii(e,t)&&(it(e),Kr(e._controlledReadableByteStream,t))}}function _a(e){let t=e._controlledReadableByteStream._reader;for(;t._readRequests.length>0;){if(e._queueTotalSize===0)return;let i=t._readRequests.shift();li(e,i)}}function Ra(e,t,i,l){let u=e._controlledReadableByteStream,d=t.constructor,h=Sa(d),{byteOffset:x,byteLength:T}=t,S=i*h,k;try{k=we(t.buffer)}catch(W){l._errorSteps(W);return}let v={buffer:k,bufferByteLength:k.byteLength,byteOffset:x,byteLength:T,bytesFilled:0,minimumFill:S,elementSize:h,viewConstructor:d,readerType:"byob"};if(e._pendingPullIntos.length>0){e._pendingPullIntos.push(v),di(u,l);return}if(u._state==="closed"){let W=new d(v.buffer,v.byteOffset,0);l._closeSteps(W);return}if(e._queueTotalSize>0){if(ii(e,v)){let W=ti(v);ai(e),l._chunkSteps(W);return}if(e._closeRequested){let W=new TypeError("Insufficient bytes to fill elements in the given buffer");re(e,W),l._errorSteps(W);return}}e._pendingPullIntos.push(v),di(u,l),Ve(e)}function Ta(e,t){t.readerType==="none"&&it(e);let i=e._controlledReadableByteStream;if(rn(i))for(;mi(i)>0;){let l=it(e);Kr(i,l)}}function Ea(e,t,i){if(oi(e,t,i),i.readerType==="none"){ni(e,i),Zr(e);return}if(i.bytesFilled<i.minimumFill)return;it(e);let l=i.bytesFilled%i.elementSize;if(l>0){let u=i.byteOffset+i.bytesFilled;ri(e,i.buffer,u-l,l)}i.bytesFilled-=l,Kr(e._controlledReadableByteStream,i),Zr(e)}function si(e,t){let i=e._pendingPullIntos.peek();Xr(e),e._controlledReadableByteStream._state==="closed"?Ta(e,i):Ea(e,t,i),Ve(e)}function it(e){return e._pendingPullIntos.shift()}function ka(e){let t=e._controlledReadableByteStream;return t._state!=="readable"||e._closeRequested||!e._started?!1:!!(Un(t)&&Nt(t)>0||rn(t)&&mi(t)>0||ui(e)>0)}function Yt(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function Tt(e){let t=e._controlledReadableByteStream;if(!(e._closeRequested||t._state!=="readable")){if(e._queueTotalSize>0){e._closeRequested=!0;return}if(e._pendingPullIntos.length>0){let i=e._pendingPullIntos.peek();if(i.bytesFilled%i.elementSize!==0){let l=new TypeError("Insufficient bytes to fill elements in the given buffer");throw re(e,l),l}}Yt(e),Bt(t)}}function Qt(e,t){let i=e._controlledReadableByteStream;if(e._closeRequested||i._state!=="readable")return;let{buffer:l,byteOffset:u,byteLength:d}=t;if(Ie(l))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let h=we(l);if(e._pendingPullIntos.length>0){let x=e._pendingPullIntos.peek();if(Ie(x.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Xr(e),x.buffer=we(x.buffer),x.readerType==="none"&&ni(e,x)}if(Un(i))if(_a(e),Nt(i)===0)Vt(e,h,u,d);else{e._pendingPullIntos.length>0&&it(e);let x=new Uint8Array(h,u,d);Nr(i,x,!1)}else rn(i)?(Vt(e,h,u,d),Zr(e)):Vt(e,h,u,d);Ve(e)}function re(e,t){let i=e._controlledReadableByteStream;i._state==="readable"&&(ei(e),qe(e),Yt(e),Wi(i,t))}function li(e,t){let i=e._queue.shift();e._queueTotalSize-=i.byteLength,ai(e);let l=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);t._chunkSteps(l)}function en(e){if(e._byobRequest===null&&e._pendingPullIntos.length>0){let t=e._pendingPullIntos.peek(),i=new Uint8Array(t.buffer,t.byteOffset+t.bytesFilled,t.byteLength-t.bytesFilled),l=Object.create($e.prototype);va(l,e,i),e._byobRequest=l}return e._byobRequest}function ui(e){let t=e._controlledReadableByteStream._state;return t==="errored"?null:t==="closed"?0:e._strategyHWM-e._queueTotalSize}function Gt(e,t){let i=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(t!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(t===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(i.bytesFilled+t>i.byteLength)throw new RangeError("bytesWritten out of range")}i.buffer=we(i.buffer),si(e,t)}function Jt(e,t){let i=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(t.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(t.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(i.byteOffset+i.bytesFilled!==t.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(i.bufferByteLength!==t.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(i.bytesFilled+t.byteLength>i.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let u=t.byteLength;i.buffer=we(t.buffer),si(e,u)}function fi(e,t,i,l,u,d,h){t._controlledReadableByteStream=e,t._pullAgain=!1,t._pulling=!1,t._byobRequest=null,t._queue=t._queueTotalSize=void 0,qe(t),t._closeRequested=!1,t._started=!1,t._strategyHWM=d,t._pullAlgorithm=l,t._cancelAlgorithm=u,t._autoAllocateChunkSize=h,t._pendingPullIntos=new D,e._readableStreamController=t;let x=i();R(m(x),()=>(t._started=!0,Ve(t),null),T=>(re(t,T),null))}function Ca(e,t,i){let l=Object.create(Se.prototype),u,d,h;t.start!==void 0?u=()=>t.start(l):u=()=>{},t.pull!==void 0?d=()=>t.pull(l):d=()=>m(void 0),t.cancel!==void 0?h=T=>t.cancel(T):h=()=>m(void 0);let x=t.autoAllocateChunkSize;if(x===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");fi(e,l,u,d,h,i,x)}function va(e,t,i){e._associatedReadableByteStreamController=t,e._view=i}function tn(e){return new TypeError(`ReadableStreamBYOBRequest.prototype.${e} can only be used on a ReadableStreamBYOBRequest`)}function Et(e){return new TypeError(`ReadableByteStreamController.prototype.${e} can only be used on a ReadableByteStreamController`)}function Pa(e,t){he(e,t);let i=e?.mode;return{mode:i===void 0?void 0:Aa(i,`${t} has member 'mode' that`)}}function Aa(e,t){if(e=`${e}`,e!=="byob")throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamReaderMode`);return e}function Ba(e,t){var i;he(e,t);let l=(i=e?.min)!==null&&i!==void 0?i:1;return{min:Mr(l,`${t} has member 'min' that`)}}function ci(e){return new We(e)}function di(e,t){e._reader._readIntoRequests.push(t)}function Fa(e,t,i){let u=e._reader._readIntoRequests.shift();i?u._closeSteps(t):u._chunkSteps(t)}function mi(e){return e._reader._readIntoRequests.length}function rn(e){let t=e._reader;return!(t===void 0||!Ye(t))}class We{constructor(t){if(xe(t,1,"ReadableStreamBYOBReader"),Ur(t,"First parameter"),je(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!He(t._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");Fe(this,t),this._readIntoRequests=new D}get closed(){return Ye(this)?this._closedPromise:b(Kt("closed"))}cancel(t=void 0){return Ye(this)?this._ownerReadableStream===void 0?b(Ut("cancel")):St(this,t):b(Kt("cancel"))}read(t,i={}){if(!Ye(this))return b(Kt("read"));if(!ArrayBuffer.isView(t))return b(new TypeError("view must be an array buffer view"));if(t.byteLength===0)return b(new TypeError("view must have non-zero byteLength"));if(t.buffer.byteLength===0)return b(new TypeError("view's buffer must have non-zero byteLength"));if(Ie(t.buffer))return b(new TypeError("view's buffer has been detached"));let l;try{l=Ba(i,"options")}catch(S){return b(S)}let u=l.min;if(u===0)return b(new TypeError("options.min must be greater than 0"));if(wa(t)){if(u>t.byteLength)return b(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(u>t.length)return b(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return b(Ut("read from"));let d,h,x=p((S,k)=>{d=S,h=k});return hi(this,t,u,{_chunkSteps:S=>d({value:S,done:!1}),_closeSteps:S=>d({value:S,done:!0}),_errorSteps:S=>h(S)}),x}releaseLock(){if(!Ye(this))throw Kt("releaseLock");this._ownerReadableStream!==void 0&&Da(this)}}Object.defineProperties(We.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),s(We.prototype.cancel,"cancel"),s(We.prototype.read,"read"),s(We.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(We.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function Ye(e){return!n(e)||!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")?!1:e instanceof We}function hi(e,t,i,l){let u=e._ownerReadableStream;u._disturbed=!0,u._state==="errored"?l._errorSteps(u._storedError):Ra(u._readableStreamController,t,i,l)}function Da(e){le(e);let t=new TypeError("Reader was released");pi(e,t)}function pi(e,t){let i=e._readIntoRequests;e._readIntoRequests=new D,i.forEach(l=>{l._errorSteps(t)})}function Kt(e){return new TypeError(`ReadableStreamBYOBReader.prototype.${e} can only be used on a ReadableStreamBYOBReader`)}function kt(e,t){let{highWaterMark:i}=e;if(i===void 0)return t;if(Qn(i)||i<0)throw new RangeError("Invalid highWaterMark");return i}function Xt(e){let{size:t}=e;return t||(()=>1)}function Zt(e,t){he(e,t);let i=e?.highWaterMark,l=e?.size;return{highWaterMark:i===void 0?void 0:jr(i),size:l===void 0?void 0:Oa(l,`${t} has member 'size' that`)}}function Oa(e,t){return te(e,t),i=>jr(e(i))}function Ia(e,t){he(e,t);let i=e?.abort,l=e?.close,u=e?.start,d=e?.type,h=e?.write;return{abort:i===void 0?void 0:qa(i,e,`${t} has member 'abort' that`),close:l===void 0?void 0:Wa(l,e,`${t} has member 'close' that`),start:u===void 0?void 0:La(u,e,`${t} has member 'start' that`),write:h===void 0?void 0:za(h,e,`${t} has member 'write' that`),type:d}}function qa(e,t,i){return te(e,i),l=>U(e,t,[l])}function Wa(e,t,i){return te(e,i),()=>U(e,t,[])}function La(e,t,i){return te(e,i),l=>q(e,t,[l])}function za(e,t,i){return te(e,i),(l,u)=>U(e,t,[l,u])}function bi(e,t){if(!ot(e))throw new TypeError(`${t} is not a WritableStream.`)}function ja(e){if(typeof e!="object"||e===null)return!1;try{return typeof e.aborted=="boolean"}catch{return!1}}let Ma=typeof AbortController=="function";function Ua(){if(Ma)return new AbortController}class Le{constructor(t={},i={}){t===void 0?t=null:zn(t,"First parameter");let l=Zt(i,"Second parameter"),u=Ia(t,"First parameter");if(yi(this),u.type!==void 0)throw new RangeError("Invalid type is specified");let h=Xt(l),x=kt(l,1);rs(this,u,x,h)}get locked(){if(!ot(this))throw ir("locked");return at(this)}abort(t=void 0){return ot(this)?at(this)?b(new TypeError("Cannot abort a stream that already has a writer")):er(this,t):b(ir("abort"))}close(){return ot(this)?at(this)?b(new TypeError("Cannot close a stream that already has a writer")):pe(this)?b(new TypeError("Cannot close an already-closing stream")):xi(this):b(ir("close"))}getWriter(){if(!ot(this))throw ir("getWriter");return gi(this)}}Object.defineProperties(Le.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),s(Le.prototype.abort,"abort"),s(Le.prototype.close,"close"),s(Le.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Le.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function gi(e){return new _e(e)}function Na(e,t,i,l,u=1,d=()=>1){let h=Object.create(Le.prototype);yi(h);let x=Object.create(st.prototype);return Ei(h,x,e,t,i,l,u,d),h}function yi(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new D,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function ot(e){return!n(e)||!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")?!1:e instanceof Le}function at(e){return e._writer!==void 0}function er(e,t){var i;if(e._state==="closed"||e._state==="errored")return m(void 0);e._writableStreamController._abortReason=t,(i=e._writableStreamController._abortController)===null||i===void 0||i.abort(t);let l=e._state;if(l==="closed"||l==="errored")return m(void 0);if(e._pendingAbortRequest!==void 0)return e._pendingAbortRequest._promise;let u=!1;l==="erroring"&&(u=!0,t=void 0);let d=p((h,x)=>{e._pendingAbortRequest={_promise:void 0,_resolve:h,_reject:x,_reason:t,_wasAlreadyErroring:u}});return e._pendingAbortRequest._promise=d,u||on(e,t),d}function xi(e){let t=e._state;if(t==="closed"||t==="errored")return b(new TypeError(`The stream (in ${t} state) is not in the writable state and cannot be closed`));let i=p((u,d)=>{let h={_resolve:u,_reject:d};e._closeRequest=h}),l=e._writer;return l!==void 0&&e._backpressure&&t==="writable"&&mn(l),ns(e._writableStreamController),i}function $a(e){return p((i,l)=>{let u={_resolve:i,_reject:l};e._writeRequests.push(u)})}function nn(e,t){if(e._state==="writable"){on(e,t);return}an(e)}function on(e,t){let i=e._writableStreamController;e._state="erroring",e._storedError=t;let l=e._writer;l!==void 0&&Si(l,t),!Ga(e)&&i._started&&an(e)}function an(e){e._state="errored",e._writableStreamController[M]();let t=e._storedError;if(e._writeRequests.forEach(u=>{u._reject(t)}),e._writeRequests=new D,e._pendingAbortRequest===void 0){tr(e);return}let i=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,i._wasAlreadyErroring){i._reject(t),tr(e);return}let l=e._writableStreamController[O](i._reason);R(l,()=>(i._resolve(),tr(e),null),u=>(i._reject(u),tr(e),null))}function Ha(e){e._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0}function Va(e,t){e._inFlightWriteRequest._reject(t),e._inFlightWriteRequest=void 0,nn(e,t)}function Ya(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,e._state==="erroring"&&(e._storedError=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";let i=e._writer;i!==void 0&&Pi(i)}function Qa(e,t){e._inFlightCloseRequest._reject(t),e._inFlightCloseRequest=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._reject(t),e._pendingAbortRequest=void 0),nn(e,t)}function pe(e){return!(e._closeRequest===void 0&&e._inFlightCloseRequest===void 0)}function Ga(e){return!(e._inFlightWriteRequest===void 0&&e._inFlightCloseRequest===void 0)}function Ja(e){e._inFlightCloseRequest=e._closeRequest,e._closeRequest=void 0}function Ka(e){e._inFlightWriteRequest=e._writeRequests.shift()}function tr(e){e._closeRequest!==void 0&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);let t=e._writer;t!==void 0&&cn(t,e._storedError)}function sn(e,t){let i=e._writer;i!==void 0&&t!==e._backpressure&&(t?fs(i):mn(i)),e._backpressure=t}class _e{constructor(t){if(xe(t,1,"WritableStreamDefaultWriter"),bi(t,"First parameter"),at(t))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=t,t._writer=this;let i=t._state;if(i==="writable")!pe(t)&&t._backpressure?ar(this):Ai(this),or(this);else if(i==="erroring")dn(this,t._storedError),or(this);else if(i==="closed")Ai(this),ls(this);else{let l=t._storedError;dn(this,l),vi(this,l)}}get closed(){return Qe(this)?this._closedPromise:b(Ge("closed"))}get desiredSize(){if(!Qe(this))throw Ge("desiredSize");if(this._ownerWritableStream===void 0)throw vt("desiredSize");return ts(this)}get ready(){return Qe(this)?this._readyPromise:b(Ge("ready"))}abort(t=void 0){return Qe(this)?this._ownerWritableStream===void 0?b(vt("abort")):Xa(this,t):b(Ge("abort"))}close(){if(!Qe(this))return b(Ge("close"));let t=this._ownerWritableStream;return t===void 0?b(vt("close")):pe(t)?b(new TypeError("Cannot close an already-closing stream")):wi(this)}releaseLock(){if(!Qe(this))throw Ge("releaseLock");this._ownerWritableStream!==void 0&&_i(this)}write(t=void 0){return Qe(this)?this._ownerWritableStream===void 0?b(vt("write to")):Ri(this,t):b(Ge("write"))}}Object.defineProperties(_e.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),s(_e.prototype.abort,"abort"),s(_e.prototype.close,"close"),s(_e.prototype.releaseLock,"releaseLock"),s(_e.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(_e.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Qe(e){return!n(e)||!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")?!1:e instanceof _e}function Xa(e,t){let i=e._ownerWritableStream;return er(i,t)}function wi(e){let t=e._ownerWritableStream;return xi(t)}function Za(e){let t=e._ownerWritableStream,i=t._state;return pe(t)||i==="closed"?m(void 0):i==="errored"?b(t._storedError):wi(e)}function es(e,t){e._closedPromiseState==="pending"?cn(e,t):us(e,t)}function Si(e,t){e._readyPromiseState==="pending"?Bi(e,t):cs(e,t)}function ts(e){let t=e._ownerWritableStream,i=t._state;return i==="errored"||i==="erroring"?null:i==="closed"?0:ki(t._writableStreamController)}function _i(e){let t=e._ownerWritableStream,i=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");Si(e,i),es(e,i),t._writer=void 0,e._ownerWritableStream=void 0}function Ri(e,t){let i=e._ownerWritableStream,l=i._writableStreamController,u=is(l,t);if(i!==e._ownerWritableStream)return b(vt("write to"));let d=i._state;if(d==="errored")return b(i._storedError);if(pe(i)||d==="closed")return b(new TypeError("The stream is closing or closed and cannot be written to"));if(d==="erroring")return b(i._storedError);let h=$a(i);return os(l,t,u),h}let Ti={};class st{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!ln(this))throw fn("abortReason");return this._abortReason}get signal(){if(!ln(this))throw fn("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(t=void 0){if(!ln(this))throw fn("error");this._controlledWritableStream._state==="writable"&&Ci(this,t)}[O](t){let i=this._abortAlgorithm(t);return rr(this),i}[M](){qe(this)}}Object.defineProperties(st.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(st.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function ln(e){return!n(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream")?!1:e instanceof st}function Ei(e,t,i,l,u,d,h,x){t._controlledWritableStream=e,e._writableStreamController=t,t._queue=void 0,t._queueTotalSize=void 0,qe(t),t._abortReason=void 0,t._abortController=Ua(),t._started=!1,t._strategySizeAlgorithm=x,t._strategyHWM=h,t._writeAlgorithm=l,t._closeAlgorithm=u,t._abortAlgorithm=d;let T=un(t);sn(e,T);let S=i(),k=m(S);R(k,()=>(t._started=!0,nr(t),null),v=>(t._started=!0,nn(e,v),null))}function rs(e,t,i,l){let u=Object.create(st.prototype),d,h,x,T;t.start!==void 0?d=()=>t.start(u):d=()=>{},t.write!==void 0?h=S=>t.write(S,u):h=()=>m(void 0),t.close!==void 0?x=()=>t.close():x=()=>m(void 0),t.abort!==void 0?T=S=>t.abort(S):T=()=>m(void 0),Ei(e,u,d,h,x,T,i,l)}function rr(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function ns(e){Gr(e,Ti,0),nr(e)}function is(e,t){try{return e._strategySizeAlgorithm(t)}catch(i){return Ct(e,i),1}}function ki(e){return e._strategyHWM-e._queueTotalSize}function os(e,t,i){try{Gr(e,t,i)}catch(u){Ct(e,u);return}let l=e._controlledWritableStream;if(!pe(l)&&l._state==="writable"){let u=un(e);sn(l,u)}nr(e)}function nr(e){let t=e._controlledWritableStream;if(!e._started||t._inFlightWriteRequest!==void 0)return;if(t._state==="erroring"){an(t);return}if(e._queue.length===0)return;let l=xa(e);l===Ti?as(e):ss(e,l)}function Ct(e,t){e._controlledWritableStream._state==="writable"&&Ci(e,t)}function as(e){let t=e._controlledWritableStream;Ja(t),Qr(e);let i=e._closeAlgorithm();rr(e),R(i,()=>(Ya(t),null),l=>(Qa(t,l),null))}function ss(e,t){let i=e._controlledWritableStream;Ka(i);let l=e._writeAlgorithm(t);R(l,()=>{Ha(i);let u=i._state;if(Qr(e),!pe(i)&&u==="writable"){let d=un(e);sn(i,d)}return nr(e),null},u=>(i._state==="writable"&&rr(e),Va(i,u),null))}function un(e){return ki(e)<=0}function Ci(e,t){let i=e._controlledWritableStream;rr(e),on(i,t)}function ir(e){return new TypeError(`WritableStream.prototype.${e} can only be used on a WritableStream`)}function fn(e){return new TypeError(`WritableStreamDefaultController.prototype.${e} can only be used on a WritableStreamDefaultController`)}function Ge(e){return new TypeError(`WritableStreamDefaultWriter.prototype.${e} can only be used on a WritableStreamDefaultWriter`)}function vt(e){return new TypeError("Cannot "+e+" a stream using a released writer")}function or(e){e._closedPromise=p((t,i)=>{e._closedPromise_resolve=t,e._closedPromise_reject=i,e._closedPromiseState="pending"})}function vi(e,t){or(e),cn(e,t)}function ls(e){or(e),Pi(e)}function cn(e,t){e._closedPromise_reject!==void 0&&(A(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected")}function us(e,t){vi(e,t)}function Pi(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved")}function ar(e){e._readyPromise=p((t,i)=>{e._readyPromise_resolve=t,e._readyPromise_reject=i}),e._readyPromiseState="pending"}function dn(e,t){ar(e),Bi(e,t)}function Ai(e){ar(e),mn(e)}function Bi(e,t){e._readyPromise_reject!==void 0&&(A(e._readyPromise),e._readyPromise_reject(t),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected")}function fs(e){ar(e)}function cs(e,t){dn(e,t)}function mn(e){e._readyPromise_resolve!==void 0&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled")}function ds(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global}let hn=ds();function ms(e){if(!(typeof e=="function"||typeof e=="object")||e.name!=="DOMException")return!1;try{return new e,!0}catch{return!1}}function hs(){let e=hn?.DOMException;return ms(e)?e:void 0}function ps(){let e=function(i,l){this.message=i||"",this.name=l||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return s(e,"DOMException"),e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,configurable:!0}),e}let bs=hs()||ps();function Fi(e,t,i,l,u,d){let h=nt(e),x=gi(t);e._disturbed=!0;let T=!1,S=m(void 0);return p((k,v)=>{let W;if(d!==void 0){if(W=()=>{let _=d.reason!==void 0?d.reason:new bs("Aborted","AbortError"),B=[];l||B.push(()=>t._state==="writable"?er(t,_):m(void 0)),u||B.push(()=>e._state==="readable"?fe(e,_):m(void 0)),V(()=>Promise.all(B.map(L=>L())),!0,_)},d.aborted){W();return}d.addEventListener("abort",W)}function ce(){return p((_,B)=>{function L(K){K?_():w(ct(),L,B)}L(!1)})}function ct(){return T?m(!0):w(x._readyPromise,()=>p((_,B)=>{_t(h,{_chunkSteps:L=>{S=w(Ri(x,L),void 0,r),_(!1)},_closeSteps:()=>_(!0),_errorSteps:B})}))}if(Te(e,h._closedPromise,_=>(l?ne(!0,_):V(()=>er(t,_),!0,_),null)),Te(t,x._closedPromise,_=>(u?ne(!0,_):V(()=>fe(e,_),!0,_),null)),H(e,h._closedPromise,()=>(i?ne():V(()=>Za(x)),null)),pe(t)||t._state==="closed"){let _=new TypeError("the destination writable stream closed before all data could be piped to it");u?ne(!0,_):V(()=>fe(e,_),!0,_)}A(ce());function Ue(){let _=S;return w(S,()=>_!==S?Ue():void 0)}function Te(_,B,L){_._state==="errored"?L(_._storedError):y(B,L)}function H(_,B,L){_._state==="closed"?L():E(B,L)}function V(_,B,L){if(T)return;T=!0,t._state==="writable"&&!pe(t)?E(Ue(),K):K();function K(){return R(_(),()=>Ee(B,L),dt=>Ee(!0,dt)),null}}function ne(_,B){T||(T=!0,t._state==="writable"&&!pe(t)?E(Ue(),()=>Ee(_,B)):Ee(_,B))}function Ee(_,B){return _i(x),le(h),d!==void 0&&d.removeEventListener("abort",W),_?v(B):k(void 0),null}})}class Re{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!sr(this))throw ur("desiredSize");return pn(this)}close(){if(!sr(this))throw ur("close");if(!ut(this))throw new TypeError("The stream is not in a state that permits close");Je(this)}enqueue(t=void 0){if(!sr(this))throw ur("enqueue");if(!ut(this))throw new TypeError("The stream is not in a state that permits enqueue");return lt(this,t)}error(t=void 0){if(!sr(this))throw ur("error");ue(this,t)}[ae](t){qe(this);let i=this._cancelAlgorithm(t);return lr(this),i}[se](t){let i=this._controlledReadableStream;if(this._queue.length>0){let l=Qr(this);this._closeRequested&&this._queue.length===0?(lr(this),Bt(i)):Pt(this),t._chunkSteps(l)}else Mn(i,t),Pt(this)}[wt](){}}Object.defineProperties(Re.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),s(Re.prototype.close,"close"),s(Re.prototype.enqueue,"enqueue"),s(Re.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Re.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function sr(e){return!n(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")?!1:e instanceof Re}function Pt(e){if(!Di(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;let i=e._pullAlgorithm();R(i,()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,Pt(e)),null),l=>(ue(e,l),null))}function Di(e){let t=e._controlledReadableStream;return!ut(e)||!e._started?!1:!!(je(t)&&Nt(t)>0||pn(e)>0)}function lr(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Je(e){if(!ut(e))return;let t=e._controlledReadableStream;e._closeRequested=!0,e._queue.length===0&&(lr(e),Bt(t))}function lt(e,t){if(!ut(e))return;let i=e._controlledReadableStream;if(je(i)&&Nt(i)>0)Nr(i,t,!1);else{let l;try{l=e._strategySizeAlgorithm(t)}catch(u){throw ue(e,u),u}try{Gr(e,t,l)}catch(u){throw ue(e,u),u}}Pt(e)}function ue(e,t){let i=e._controlledReadableStream;i._state==="readable"&&(qe(e),lr(e),Wi(i,t))}function pn(e){let t=e._controlledReadableStream._state;return t==="errored"?null:t==="closed"?0:e._strategyHWM-e._queueTotalSize}function gs(e){return!Di(e)}function ut(e){let t=e._controlledReadableStream._state;return!e._closeRequested&&t==="readable"}function Oi(e,t,i,l,u,d,h){t._controlledReadableStream=e,t._queue=void 0,t._queueTotalSize=void 0,qe(t),t._started=!1,t._closeRequested=!1,t._pullAgain=!1,t._pulling=!1,t._strategySizeAlgorithm=h,t._strategyHWM=d,t._pullAlgorithm=l,t._cancelAlgorithm=u,e._readableStreamController=t;let x=i();R(m(x),()=>(t._started=!0,Pt(t),null),T=>(ue(t,T),null))}function ys(e,t,i,l){let u=Object.create(Re.prototype),d,h,x;t.start!==void 0?d=()=>t.start(u):d=()=>{},t.pull!==void 0?h=()=>t.pull(u):h=()=>m(void 0),t.cancel!==void 0?x=T=>t.cancel(T):x=()=>m(void 0),Oi(e,u,d,h,x,i,l)}function ur(e){return new TypeError(`ReadableStreamDefaultController.prototype.${e} can only be used on a ReadableStreamDefaultController`)}function xs(e,t){return He(e._readableStreamController)?Ss(e):ws(e)}function ws(e,t){let i=nt(e),l=!1,u=!1,d=!1,h=!1,x,T,S,k,v,W=p(H=>{v=H});function ce(){return l?(u=!0,m(void 0)):(l=!0,_t(i,{_chunkSteps:V=>{P(()=>{u=!1;let ne=V,Ee=V;d||lt(S._readableStreamController,ne),h||lt(k._readableStreamController,Ee),l=!1,u&&ce()})},_closeSteps:()=>{l=!1,d||Je(S._readableStreamController),h||Je(k._readableStreamController),(!d||!h)&&v(void 0)},_errorSteps:()=>{l=!1}}),m(void 0))}function ct(H){if(d=!0,x=H,h){let V=Rt([x,T]),ne=fe(e,V);v(ne)}return W}function Ue(H){if(h=!0,T=H,d){let V=Rt([x,T]),ne=fe(e,V);v(ne)}return W}function Te(){}return S=At(Te,ce,ct),k=At(Te,ce,Ue),y(i._closedPromise,H=>(ue(S._readableStreamController,H),ue(k._readableStreamController,H),(!d||!h)&&v(void 0),null)),[S,k]}function Ss(e){let t=nt(e),i=!1,l=!1,u=!1,d=!1,h=!1,x,T,S,k,v,W=p(_=>{v=_});function ce(_){y(_._closedPromise,B=>(_!==t||(re(S._readableStreamController,B),re(k._readableStreamController,B),(!d||!h)&&v(void 0)),null))}function ct(){Ye(t)&&(le(t),t=nt(e),ce(t)),_t(t,{_chunkSteps:B=>{P(()=>{l=!1,u=!1;let L=B,K=B;if(!d&&!h)try{K=Xn(B)}catch(dt){re(S._readableStreamController,dt),re(k._readableStreamController,dt),v(fe(e,dt));return}d||Qt(S._readableStreamController,L),h||Qt(k._readableStreamController,K),i=!1,l?Te():u&&H()})},_closeSteps:()=>{i=!1,d||Tt(S._readableStreamController),h||Tt(k._readableStreamController),S._readableStreamController._pendingPullIntos.length>0&&Gt(S._readableStreamController,0),k._readableStreamController._pendingPullIntos.length>0&&Gt(k._readableStreamController,0),(!d||!h)&&v(void 0)},_errorSteps:()=>{i=!1}})}function Ue(_,B){Oe(t)&&(le(t),t=ci(e),ce(t));let L=B?k:S,K=B?S:k;hi(t,_,1,{_chunkSteps:mt=>{P(()=>{l=!1,u=!1;let ht=B?h:d;if(B?d:h)ht||Jt(L._readableStreamController,mt);else{let Ji;try{Ji=Xn(mt)}catch(wn){re(L._readableStreamController,wn),re(K._readableStreamController,wn),v(fe(e,wn));return}ht||Jt(L._readableStreamController,mt),Qt(K._readableStreamController,Ji)}i=!1,l?Te():u&&H()})},_closeSteps:mt=>{i=!1;let ht=B?h:d,gr=B?d:h;ht||Tt(L._readableStreamController),gr||Tt(K._readableStreamController),mt!==void 0&&(ht||Jt(L._readableStreamController,mt),!gr&&K._readableStreamController._pendingPullIntos.length>0&&Gt(K._readableStreamController,0)),(!ht||!gr)&&v(void 0)},_errorSteps:()=>{i=!1}})}function Te(){if(i)return l=!0,m(void 0);i=!0;let _=en(S._readableStreamController);return _===null?ct():Ue(_._view,!1),m(void 0)}function H(){if(i)return u=!0,m(void 0);i=!0;let _=en(k._readableStreamController);return _===null?ct():Ue(_._view,!0),m(void 0)}function V(_){if(d=!0,x=_,h){let B=Rt([x,T]),L=fe(e,B);v(L)}return W}function ne(_){if(h=!0,T=_,d){let B=Rt([x,T]),L=fe(e,B);v(L)}return W}function Ee(){}return S=qi(Ee,Te,V),k=qi(Ee,H,ne),ce(t),[S,k]}function _s(e){return n(e)&&typeof e.getReader<"u"}function Rs(e){return _s(e)?Es(e.getReader()):Ts(e)}function Ts(e){let t,i=Kn(e,"async"),l=r;function u(){let h;try{h=pa(i)}catch(T){return b(T)}let x=m(h);return I(x,T=>{if(!n(T))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(ba(T))Je(t._readableStreamController);else{let k=ga(T);lt(t._readableStreamController,k)}})}function d(h){let x=i.iterator,T;try{T=Ht(x,"return")}catch(v){return b(v)}if(T===void 0)return m(void 0);let S;try{S=q(T,x,[h])}catch(v){return b(v)}let k=m(S);return I(k,v=>{if(!n(v))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return t=At(l,u,d,0),t}function Es(e){let t,i=r;function l(){let d;try{d=e.read()}catch(h){return b(h)}return I(d,h=>{if(!n(h))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(h.done)Je(t._readableStreamController);else{let x=h.value;lt(t._readableStreamController,x)}})}function u(d){try{return m(e.cancel(d))}catch(h){return b(h)}}return t=At(i,l,u,0),t}function ks(e,t){he(e,t);let i=e,l=i?.autoAllocateChunkSize,u=i?.cancel,d=i?.pull,h=i?.start,x=i?.type;return{autoAllocateChunkSize:l===void 0?void 0:Mr(l,`${t} has member 'autoAllocateChunkSize' that`),cancel:u===void 0?void 0:Cs(u,i,`${t} has member 'cancel' that`),pull:d===void 0?void 0:vs(d,i,`${t} has member 'pull' that`),start:h===void 0?void 0:Ps(h,i,`${t} has member 'start' that`),type:x===void 0?void 0:As(x,`${t} has member 'type' that`)}}function Cs(e,t,i){return te(e,i),l=>U(e,t,[l])}function vs(e,t,i){return te(e,i),l=>U(e,t,[l])}function Ps(e,t,i){return te(e,i),l=>q(e,t,[l])}function As(e,t){if(e=`${e}`,e!=="bytes")throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamType`);return e}function Bs(e,t){return he(e,t),{preventCancel:!!e?.preventCancel}}function Ii(e,t){he(e,t);let i=e?.preventAbort,l=e?.preventCancel,u=e?.preventClose,d=e?.signal;return d!==void 0&&Fs(d,`${t} has member 'signal' that`),{preventAbort:!!i,preventCancel:!!l,preventClose:!!u,signal:d}}function Fs(e,t){if(!ja(e))throw new TypeError(`${t} is not an AbortSignal.`)}function Ds(e,t){he(e,t);let i=e?.readable;zr(i,"readable","ReadableWritablePair"),Ur(i,`${t} has member 'readable' that`);let l=e?.writable;return zr(l,"writable","ReadableWritablePair"),bi(l,`${t} has member 'writable' that`),{readable:i,writable:l}}class ${constructor(t={},i={}){t===void 0?t=null:zn(t,"First parameter");let l=Zt(i,"Second parameter"),u=ks(t,"First parameter");if(bn(this),u.type==="bytes"){if(l.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let d=kt(l,0);Ca(this,u,d)}else{let d=Xt(l),h=kt(l,1);ys(this,u,h,d)}}get locked(){if(!ze(this))throw Ke("locked");return je(this)}cancel(t=void 0){return ze(this)?je(this)?b(new TypeError("Cannot cancel a stream that already has a reader")):fe(this,t):b(Ke("cancel"))}getReader(t=void 0){if(!ze(this))throw Ke("getReader");return Pa(t,"First parameter").mode===void 0?nt(this):ci(this)}pipeThrough(t,i={}){if(!ze(this))throw Ke("pipeThrough");xe(t,1,"pipeThrough");let l=Ds(t,"First parameter"),u=Ii(i,"Second parameter");if(je(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(at(l.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let d=Fi(this,l.writable,u.preventClose,u.preventAbort,u.preventCancel,u.signal);return A(d),l.readable}pipeTo(t,i={}){if(!ze(this))return b(Ke("pipeTo"));if(t===void 0)return b("Parameter 1 is required in 'pipeTo'.");if(!ot(t))return b(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let l;try{l=Ii(i,"Second parameter")}catch(u){return b(u)}return je(this)?b(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):at(t)?b(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):Fi(this,t,l.preventClose,l.preventAbort,l.preventCancel,l.signal)}tee(){if(!ze(this))throw Ke("tee");let t=xs(this);return Rt(t)}values(t=void 0){if(!ze(this))throw Ke("values");let i=Bs(t,"First parameter");return ma(this,i.preventCancel)}[Yr](t){return this.values(t)}static from(t){return Rs(t)}}Object.defineProperties($,{from:{enumerable:!0}}),Object.defineProperties($.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),s($.from,"from"),s($.prototype.cancel,"cancel"),s($.prototype.getReader,"getReader"),s($.prototype.pipeThrough,"pipeThrough"),s($.prototype.pipeTo,"pipeTo"),s($.prototype.tee,"tee"),s($.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty($.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty($.prototype,Yr,{value:$.prototype.values,writable:!0,configurable:!0});function At(e,t,i,l=1,u=()=>1){let d=Object.create($.prototype);bn(d);let h=Object.create(Re.prototype);return Oi(d,h,e,t,i,l,u),d}function qi(e,t,i){let l=Object.create($.prototype);bn(l);let u=Object.create(Se.prototype);return fi(l,u,e,t,i,0,void 0),l}function bn(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function ze(e){return!n(e)||!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")?!1:e instanceof $}function je(e){return e._reader!==void 0}function fe(e,t){if(e._disturbed=!0,e._state==="closed")return m(void 0);if(e._state==="errored")return b(e._storedError);Bt(e);let i=e._reader;if(i!==void 0&&Ye(i)){let u=i._readIntoRequests;i._readIntoRequests=new D,u.forEach(d=>{d._closeSteps(void 0)})}let l=e._readableStreamController[ae](t);return I(l,r)}function Bt(e){e._state="closed";let t=e._reader;if(t!==void 0&&(Wn(t),Oe(t))){let i=t._readRequests;t._readRequests=new D,i.forEach(l=>{l._closeSteps()})}}function Wi(e,t){e._state="errored",e._storedError=t;let i=e._reader;i!==void 0&&(Lr(i,t),Oe(i)?Nn(i,t):pi(i,t))}function Ke(e){return new TypeError(`ReadableStream.prototype.${e} can only be used on a ReadableStream`)}function Li(e,t){he(e,t);let i=e?.highWaterMark;return zr(i,"highWaterMark","QueuingStrategyInit"),{highWaterMark:jr(i)}}let zi=e=>e.byteLength;s(zi,"size");class fr{constructor(t){xe(t,1,"ByteLengthQueuingStrategy"),t=Li(t,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=t.highWaterMark}get highWaterMark(){if(!Mi(this))throw ji("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!Mi(this))throw ji("size");return zi}}Object.defineProperties(fr.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(fr.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function ji(e){return new TypeError(`ByteLengthQueuingStrategy.prototype.${e} can only be used on a ByteLengthQueuingStrategy`)}function Mi(e){return!n(e)||!Object.prototype.hasOwnProperty.call(e,"_byteLengthQueuingStrategyHighWaterMark")?!1:e instanceof fr}let Ui=()=>1;s(Ui,"size");class cr{constructor(t){xe(t,1,"CountQueuingStrategy"),t=Li(t,"First parameter"),this._countQueuingStrategyHighWaterMark=t.highWaterMark}get highWaterMark(){if(!$i(this))throw Ni("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!$i(this))throw Ni("size");return Ui}}Object.defineProperties(cr.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(cr.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function Ni(e){return new TypeError(`CountQueuingStrategy.prototype.${e} can only be used on a CountQueuingStrategy`)}function $i(e){return!n(e)||!Object.prototype.hasOwnProperty.call(e,"_countQueuingStrategyHighWaterMark")?!1:e instanceof cr}function Os(e,t){he(e,t);let i=e?.cancel,l=e?.flush,u=e?.readableType,d=e?.start,h=e?.transform,x=e?.writableType;return{cancel:i===void 0?void 0:Ls(i,e,`${t} has member 'cancel' that`),flush:l===void 0?void 0:Is(l,e,`${t} has member 'flush' that`),readableType:u,start:d===void 0?void 0:qs(d,e,`${t} has member 'start' that`),transform:h===void 0?void 0:Ws(h,e,`${t} has member 'transform' that`),writableType:x}}function Is(e,t,i){return te(e,i),l=>U(e,t,[l])}function qs(e,t,i){return te(e,i),l=>q(e,t,[l])}function Ws(e,t,i){return te(e,i),(l,u)=>U(e,t,[l,u])}function Ls(e,t,i){return te(e,i),l=>U(e,t,[l])}class dr{constructor(t={},i={},l={}){t===void 0&&(t=null);let u=Zt(i,"Second parameter"),d=Zt(l,"Third parameter"),h=Os(t,"First parameter");if(h.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(h.writableType!==void 0)throw new RangeError("Invalid writableType specified");let x=kt(d,0),T=Xt(d),S=kt(u,1),k=Xt(u),v,W=p(ce=>{v=ce});zs(this,W,S,k,x,T),Ms(this,h),h.start!==void 0?v(h.start(this._transformStreamController)):v(void 0)}get readable(){if(!Hi(this))throw Gi("readable");return this._readable}get writable(){if(!Hi(this))throw Gi("writable");return this._writable}}Object.defineProperties(dr.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(dr.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function zs(e,t,i,l,u,d){function h(){return t}function x(W){return $s(e,W)}function T(W){return Hs(e,W)}function S(){return Vs(e)}e._writable=Na(h,x,S,T,i,l);function k(){return Ys(e)}function v(W){return Qs(e,W)}e._readable=At(h,k,v,u,d),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,mr(e,!0),e._transformStreamController=void 0}function Hi(e){return!n(e)||!Object.prototype.hasOwnProperty.call(e,"_transformStreamController")?!1:e instanceof dr}function Vi(e,t){ue(e._readable._readableStreamController,t),gn(e,t)}function gn(e,t){pr(e._transformStreamController),Ct(e._writable._writableStreamController,t),yn(e)}function yn(e){e._backpressure&&mr(e,!1)}function mr(e,t){e._backpressureChangePromise!==void 0&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=p(i=>{e._backpressureChangePromise_resolve=i}),e._backpressure=t}class Me{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!hr(this))throw br("desiredSize");let t=this._controlledTransformStream._readable._readableStreamController;return pn(t)}enqueue(t=void 0){if(!hr(this))throw br("enqueue");Yi(this,t)}error(t=void 0){if(!hr(this))throw br("error");Us(this,t)}terminate(){if(!hr(this))throw br("terminate");Ns(this)}}Object.defineProperties(Me.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),s(Me.prototype.enqueue,"enqueue"),s(Me.prototype.error,"error"),s(Me.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Me.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function hr(e){return!n(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")?!1:e instanceof Me}function js(e,t,i,l,u){t._controlledTransformStream=e,e._transformStreamController=t,t._transformAlgorithm=i,t._flushAlgorithm=l,t._cancelAlgorithm=u,t._finishPromise=void 0,t._finishPromise_resolve=void 0,t._finishPromise_reject=void 0}function Ms(e,t){let i=Object.create(Me.prototype),l,u,d;t.transform!==void 0?l=h=>t.transform(h,i):l=h=>{try{return Yi(i,h),m(void 0)}catch(x){return b(x)}},t.flush!==void 0?u=()=>t.flush(i):u=()=>m(void 0),t.cancel!==void 0?d=h=>t.cancel(h):d=()=>m(void 0),js(e,i,l,u,d)}function pr(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0,e._cancelAlgorithm=void 0}function Yi(e,t){let i=e._controlledTransformStream,l=i._readable._readableStreamController;if(!ut(l))throw new TypeError("Readable side is not in a state that permits enqueue");try{lt(l,t)}catch(d){throw gn(i,d),i._readable._storedError}gs(l)!==i._backpressure&&mr(i,!0)}function Us(e,t){Vi(e._controlledTransformStream,t)}function Qi(e,t){let i=e._transformAlgorithm(t);return I(i,void 0,l=>{throw Vi(e._controlledTransformStream,l),l})}function Ns(e){let t=e._controlledTransformStream,i=t._readable._readableStreamController;Je(i);let l=new TypeError("TransformStream terminated");gn(t,l)}function $s(e,t){let i=e._transformStreamController;if(e._backpressure){let l=e._backpressureChangePromise;return I(l,()=>{let u=e._writable;if(u._state==="erroring")throw u._storedError;return Qi(i,t)})}return Qi(i,t)}function Hs(e,t){let i=e._transformStreamController;if(i._finishPromise!==void 0)return i._finishPromise;let l=e._readable;i._finishPromise=p((d,h)=>{i._finishPromise_resolve=d,i._finishPromise_reject=h});let u=i._cancelAlgorithm(t);return pr(i),R(u,()=>(l._state==="errored"?ft(i,l._storedError):(ue(l._readableStreamController,t),xn(i)),null),d=>(ue(l._readableStreamController,d),ft(i,d),null)),i._finishPromise}function Vs(e){let t=e._transformStreamController;if(t._finishPromise!==void 0)return t._finishPromise;let i=e._readable;t._finishPromise=p((u,d)=>{t._finishPromise_resolve=u,t._finishPromise_reject=d});let l=t._flushAlgorithm();return pr(t),R(l,()=>(i._state==="errored"?ft(t,i._storedError):(Je(i._readableStreamController),xn(t)),null),u=>(ue(i._readableStreamController,u),ft(t,u),null)),t._finishPromise}function Ys(e){return mr(e,!1),e._backpressureChangePromise}function Qs(e,t){let i=e._transformStreamController;if(i._finishPromise!==void 0)return i._finishPromise;let l=e._writable;i._finishPromise=p((d,h)=>{i._finishPromise_resolve=d,i._finishPromise_reject=h});let u=i._cancelAlgorithm(t);return pr(i),R(u,()=>(l._state==="errored"?ft(i,l._storedError):(Ct(l._writableStreamController,t),yn(e),xn(i)),null),d=>(Ct(l._writableStreamController,d),yn(e),ft(i,d),null)),i._finishPromise}function br(e){return new TypeError(`TransformStreamDefaultController.prototype.${e} can only be used on a TransformStreamDefaultController`)}function xn(e){e._finishPromise_resolve!==void 0&&(e._finishPromise_resolve(),e._finishPromise_resolve=void 0,e._finishPromise_reject=void 0)}function ft(e,t){e._finishPromise_reject!==void 0&&(A(e._finishPromise),e._finishPromise_reject(t),e._finishPromise_resolve=void 0,e._finishPromise_reject=void 0)}function Gi(e){return new TypeError(`TransformStream.prototype.${e} can only be used on a TransformStream`)}o.ByteLengthQueuingStrategy=fr,o.CountQueuingStrategy=cr,o.ReadableByteStreamController=Se,o.ReadableStream=$,o.ReadableStreamBYOBReader=We,o.ReadableStreamBYOBRequest=$e,o.ReadableStreamDefaultController=Re,o.ReadableStreamDefaultReader=De,o.TransformStream=dr,o.TransformStreamDefaultController=Me,o.WritableStream=Le,o.WritableStreamDefaultController=st,o.WritableStreamDefaultWriter=_e})});var ro=xr(()=>{if(!globalThis.ReadableStream)try{let o=require("node:process"),{emitWarning:r}=o;try{o.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),o.emitWarning=r}catch(n){throw o.emitWarning=r,n}}catch{Object.assign(globalThis,to())}try{let{Blob:o}=require("buffer");o&&!o.prototype.stream&&(o.prototype.stream=function(n){let a=0,s=this;return new ReadableStream({type:"bytes",async pull(f){let g=await s.slice(a,Math.min(s.size,a+65536)).arrayBuffer();a+=g.byteLength,f.enqueue(new Uint8Array(g)),a===s.size&&f.close()}})})}catch{}});async function*Sn(o,r=!0){for(let n of o)if("stream"in n)yield*n.stream();else if(ArrayBuffer.isView(n))if(r){let a=n.byteOffset,s=n.byteOffset+n.byteLength;for(;a!==s;){let f=Math.min(s-a,no),c=n.buffer.slice(a,a+f);a+=c.byteLength,yield new Uint8Array(c)}}else yield n;else{let a=0,s=n;for(;a!==s.size;){let c=await s.slice(a,Math.min(s.size,a+no)).arrayBuffer();a+=c.byteLength,yield new Uint8Array(c)}}}var Nl,no,io,rl,ke,Dt=Ft(()=>{Nl=de(ro(),1);no=65536;io=class _n{#e=[];#t="";#r=0;#n="transparent";constructor(r=[],n={}){if(typeof r!="object"||r===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof r[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof n!="object"&&typeof n!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");n===null&&(n={});let a=new TextEncoder;for(let f of r){let c;ArrayBuffer.isView(f)?c=new Uint8Array(f.buffer.slice(f.byteOffset,f.byteOffset+f.byteLength)):f instanceof ArrayBuffer?c=new Uint8Array(f.slice(0)):f instanceof _n?c=f:c=a.encode(`${f}`),this.#r+=ArrayBuffer.isView(c)?c.byteLength:c.size,this.#e.push(c)}this.#n=`${n.endings===void 0?"transparent":n.endings}`;let s=n.type===void 0?"":String(n.type);this.#t=/^[\x20-\x7E]*$/.test(s)?s:""}get size(){return this.#r}get type(){return this.#t}async text(){let r=new TextDecoder,n="";for await(let a of Sn(this.#e,!1))n+=r.decode(a,{stream:!0});return n+=r.decode(),n}async arrayBuffer(){let r=new Uint8Array(this.size),n=0;for await(let a of Sn(this.#e,!1))r.set(a,n),n+=a.length;return r.buffer}stream(){let r=Sn(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(n){let a=await r.next();a.done?n.close():n.enqueue(a.value)},async cancel(){await r.return()}})}slice(r=0,n=this.size,a=""){let{size:s}=this,f=r<0?Math.max(s+r,0):Math.min(r,s),c=n<0?Math.max(s+n,0):Math.min(n,s),g=Math.max(c-f,0),p=this.#e,m=[],b=0;for(let R of p){if(b>=g)break;let E=ArrayBuffer.isView(R)?R.byteLength:R.size;if(f&&E<=f)f-=E,c-=E;else{let y;ArrayBuffer.isView(R)?(y=R.subarray(f,Math.min(E,c)),b+=y.byteLength):(y=R.slice(f,Math.min(E,c)),b+=y.size),c-=E,m.push(y),f=0}}let w=new _n([],{type:String(a).toLowerCase()});return w.#r=g,w.#e=m,w}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](r){return r&&typeof r=="object"&&typeof r.constructor=="function"&&(typeof r.stream=="function"||typeof r.arrayBuffer=="function")&&/^(Blob|File)$/.test(r[Symbol.toStringTag])}};Object.defineProperties(io.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});rl=io,ke=rl});var nl,il,pt,Rn=Ft(()=>{Dt();nl=class extends ke{#e=0;#t="";constructor(r,n,a={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(r,a),a===null&&(a={});let s=a.lastModified===void 0?Date.now():Number(a.lastModified);Number.isNaN(s)||(this.#e=s),this.#t=String(n)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](r){return!!r&&r instanceof ke&&/^(File)$/.test(r[Symbol.toStringTag])}},il=nl,pt=il});function so(o,r=ke){var n=`${oo()}${oo()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),a=[],s=`--${n}\r
Content-Disposition: form-data; name="`;return o.forEach((f,c)=>typeof f=="string"?a.push(s+Tn(c)+`"\r
\r
${f.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):a.push(s+Tn(c)+`"; filename="${Tn(f.name,1)}"\r
Content-Type: ${f.type||"application/octet-stream"}\r
\r
`,f,`\r
`)),a.push(`--${n}--`),new r(a,{type:"multipart/form-data; boundary="+n})}var Ot,ol,al,oo,sl,ao,Tn,Xe,Ze,Sr=Ft(()=>{Dt();Rn();({toStringTag:Ot,iterator:ol,hasInstance:al}=Symbol),oo=Math.random,sl="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),ao=(o,r,n)=>(o+="",/^(Blob|File)$/.test(r&&r[Ot])?[(n=n!==void 0?n+"":r[Ot]=="File"?r.name:"blob",o),r.name!==n||r[Ot]=="blob"?new pt([r],n,r):r]:[o,r+""]),Tn=(o,r)=>(r?o:o.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),Xe=(o,r,n)=>{if(r.length<n)throw new TypeError(`Failed to execute '${o}' on 'FormData': ${n} arguments required, but only ${r.length} present.`)},Ze=class{#e=[];constructor(...r){if(r.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[Ot](){return"FormData"}[ol](){return this.entries()}static[al](r){return r&&typeof r=="object"&&r[Ot]==="FormData"&&!sl.some(n=>typeof r[n]!="function")}append(...r){Xe("append",arguments,2),this.#e.push(ao(...r))}delete(r){Xe("delete",arguments,1),r+="",this.#e=this.#e.filter(([n])=>n!==r)}get(r){Xe("get",arguments,1),r+="";for(var n=this.#e,a=n.length,s=0;s<a;s++)if(n[s][0]===r)return n[s][1];return null}getAll(r,n){return Xe("getAll",arguments,1),n=[],r+="",this.#e.forEach(a=>a[0]===r&&n.push(a[1])),n}has(r){return Xe("has",arguments,1),r+="",this.#e.some(n=>n[0]===r)}forEach(r,n){Xe("forEach",arguments,1);for(var[a,s]of this)r.call(n,s,a,this)}set(...r){Xe("set",arguments,2);var n=[],a=!0;r=ao(...r),this.#e.forEach(s=>{s[0]===r[0]?a&&(a=!n.push(r)):n.push(s)}),a&&n.push(r),this.#e=n}*entries(){yield*this.#e}*keys(){for(var[r]of this)yield r}*values(){for(var[,r]of this)yield r}}});var mo=xr((ru,co)=>{if(!globalThis.DOMException)try{let{MessageChannel:o}=require("worker_threads"),r=new o().port1,n=new ArrayBuffer;r.postMessage(n,[n,n])}catch(o){o.constructor.name==="DOMException"&&(globalThis.DOMException=o.constructor)}co.exports=globalThis.DOMException});var Rr,ll,ou,kn=Ft(()=>{Rr=require("node:fs"),ll=de(mo(),1);Rn();Dt();({stat:ou}=Rr.promises)});var po={};Ki(po,{toFormData:()=>pl});function hl(o){let r=o.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!r)return;let n=r[2]||r[3]||"",a=n.slice(n.lastIndexOf("\\")+1);return a=a.replace(/%22/g,'"'),a=a.replace(/&#(\d{4});/g,(s,f)=>String.fromCharCode(f)),a}async function pl(o,r){if(!/multipart/i.test(r))throw new TypeError("Failed to fetch");let n=r.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!n)throw new TypeError("no or bad content-type header, no multipart boundary");let a=new Cn(n[1]||n[2]),s,f,c,g,p,m,b=[],w=new Ze,R=P=>{c+=A.decode(P,{stream:!0})},E=P=>{b.push(P)},y=()=>{let P=new pt(b,m,{type:p});w.append(g,P)},I=()=>{w.append(g,c)},A=new TextDecoder("utf-8");A.decode(),a.onPartBegin=function(){a.onPartData=R,a.onPartEnd=I,s="",f="",c="",g="",p="",m=null,b.length=0},a.onHeaderField=function(P){s+=A.decode(P,{stream:!0})},a.onHeaderValue=function(P){f+=A.decode(P,{stream:!0})},a.onHeaderEnd=function(){if(f+=A.decode(),s=s.toLowerCase(),s==="content-disposition"){let P=f.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);P&&(g=P[2]||P[3]||""),m=hl(f),m&&(a.onPartData=E,a.onPartEnd=y)}else s==="content-type"&&(p=f);f="",s=""};for await(let P of o)a.write(P);return a.end(),w}var be,z,ho,Ne,Tr,Er,ul,qt,fl,cl,dl,ml,et,Cn,bo=Ft(()=>{kn();Sr();be=0,z={START_BOUNDARY:be++,HEADER_FIELD_START:be++,HEADER_FIELD:be++,HEADER_VALUE_START:be++,HEADER_VALUE:be++,HEADER_VALUE_ALMOST_DONE:be++,HEADERS_ALMOST_DONE:be++,PART_DATA_START:be++,PART_DATA:be++,END:be++},ho=1,Ne={PART_BOUNDARY:ho,LAST_BOUNDARY:ho*=2},Tr=10,Er=13,ul=32,qt=45,fl=58,cl=97,dl=122,ml=o=>o|32,et=()=>{},Cn=class{constructor(r){this.index=0,this.flags=0,this.onHeaderEnd=et,this.onHeaderField=et,this.onHeadersEnd=et,this.onHeaderValue=et,this.onPartBegin=et,this.onPartData=et,this.onPartEnd=et,this.boundaryChars={},r=`\r
--`+r;let n=new Uint8Array(r.length);for(let a=0;a<r.length;a++)n[a]=r.charCodeAt(a),this.boundaryChars[n[a]]=!0;this.boundary=n,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=z.START_BOUNDARY}write(r){let n=0,a=r.length,s=this.index,{lookbehind:f,boundary:c,boundaryChars:g,index:p,state:m,flags:b}=this,w=this.boundary.length,R=w-1,E=r.length,y,I,A=F=>{this[F+"Mark"]=n},P=F=>{delete this[F+"Mark"]},q=(F,D,O,M)=>{(D===void 0||D!==O)&&this[F](M&&M.subarray(D,O))},U=(F,D)=>{let O=F+"Mark";O in this&&(D?(q(F,this[O],n,r),delete this[O]):(q(F,this[O],r.length,r),this[O]=0))};for(n=0;n<a;n++)switch(y=r[n],m){case z.START_BOUNDARY:if(p===c.length-2){if(y===qt)b|=Ne.LAST_BOUNDARY;else if(y!==Er)return;p++;break}else if(p-1===c.length-2){if(b&Ne.LAST_BOUNDARY&&y===qt)m=z.END,b=0;else if(!(b&Ne.LAST_BOUNDARY)&&y===Tr)p=0,q("onPartBegin"),m=z.HEADER_FIELD_START;else return;break}y!==c[p+2]&&(p=-2),y===c[p+2]&&p++;break;case z.HEADER_FIELD_START:m=z.HEADER_FIELD,A("onHeaderField"),p=0;case z.HEADER_FIELD:if(y===Er){P("onHeaderField"),m=z.HEADERS_ALMOST_DONE;break}if(p++,y===qt)break;if(y===fl){if(p===1)return;U("onHeaderField",!0),m=z.HEADER_VALUE_START;break}if(I=ml(y),I<cl||I>dl)return;break;case z.HEADER_VALUE_START:if(y===ul)break;A("onHeaderValue"),m=z.HEADER_VALUE;case z.HEADER_VALUE:y===Er&&(U("onHeaderValue",!0),q("onHeaderEnd"),m=z.HEADER_VALUE_ALMOST_DONE);break;case z.HEADER_VALUE_ALMOST_DONE:if(y!==Tr)return;m=z.HEADER_FIELD_START;break;case z.HEADERS_ALMOST_DONE:if(y!==Tr)return;q("onHeadersEnd"),m=z.PART_DATA_START;break;case z.PART_DATA_START:m=z.PART_DATA,A("onPartData");case z.PART_DATA:if(s=p,p===0){for(n+=R;n<E&&!(r[n]in g);)n+=w;n-=R,y=r[n]}if(p<c.length)c[p]===y?(p===0&&U("onPartData",!0),p++):p=0;else if(p===c.length)p++,y===Er?b|=Ne.PART_BOUNDARY:y===qt?b|=Ne.LAST_BOUNDARY:p=0;else if(p-1===c.length)if(b&Ne.PART_BOUNDARY){if(p=0,y===Tr){b&=~Ne.PART_BOUNDARY,q("onPartEnd"),q("onPartBegin"),m=z.HEADER_FIELD_START;break}}else b&Ne.LAST_BOUNDARY&&y===qt?(q("onPartEnd"),m=z.END,b=0):p=0;if(p>0)f[p-1]=y;else if(s>0){let F=new Uint8Array(f.buffer,f.byteOffset,f.byteLength);q("onPartData",0,s,F),s=0,A("onPartData"),n--}break;case z.END:break;default:throw new Error(`Unexpected state entered: ${m}`)}U("onHeaderField"),U("onHeaderValue"),U("onPartData"),this.index=p,this.state=m,this.flags=b}end(){if(this.state===z.HEADER_FIELD_START&&this.index===0||this.state===z.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==z.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});var Io=xr(Fn=>{Fn.read=function(o,r,n,a,s){var f,c,g=s*8-a-1,p=(1<<g)-1,m=p>>1,b=-7,w=n?s-1:0,R=n?-1:1,E=o[r+w];for(w+=R,f=E&(1<<-b)-1,E>>=-b,b+=g;b>0;f=f*256+o[r+w],w+=R,b-=8);for(c=f&(1<<-b)-1,f>>=-b,b+=a;b>0;c=c*256+o[r+w],w+=R,b-=8);if(f===0)f=1-m;else{if(f===p)return c?NaN:(E?-1:1)*(1/0);c=c+Math.pow(2,a),f=f-m}return(E?-1:1)*c*Math.pow(2,f-a)};Fn.write=function(o,r,n,a,s,f){var c,g,p,m=f*8-s-1,b=(1<<m)-1,w=b>>1,R=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=a?0:f-1,y=a?1:-1,I=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(g=isNaN(r)?1:0,c=b):(c=Math.floor(Math.log(r)/Math.LN2),r*(p=Math.pow(2,-c))<1&&(c--,p*=2),c+w>=1?r+=R/p:r+=R*Math.pow(2,1-w),r*p>=2&&(c++,p/=2),c+w>=b?(g=0,c=b):c+w>=1?(g=(r*p-1)*Math.pow(2,s),c=c+w):(g=r*Math.pow(2,w-1)*Math.pow(2,s),c=0));s>=8;o[n+E]=g&255,E+=y,g/=256,s-=8);for(c=c<<s|g,m+=s;m>0;o[n+E]=c&255,E+=y,c/=256,m-=8);o[n+E-y]|=I*128}});var Ll={};Ki(Ll,{default:()=>ia});module.exports=el(Ll);var C=require("@raycast/api"),Be=require("react");var Bo=de(require("node:http"),1),Fo=de(require("node:https"),1),rt=de(require("node:zlib"),1),ee=de(require("node:stream"),1),zt=require("node:buffer");function tl(o){if(!/^data:/i.test(o))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');o=o.replace(/\r?\n/g,"");let r=o.indexOf(",");if(r===-1||r<=4)throw new TypeError("malformed data: URI");let n=o.substring(5,r).split(";"),a="",s=!1,f=n[0]||"text/plain",c=f;for(let b=1;b<n.length;b++)n[b]==="base64"?s=!0:n[b]&&(c+=`;${n[b]}`,n[b].indexOf("charset=")===0&&(a=n[b].substring(8)));!n[0]&&!a.length&&(c+=";charset=US-ASCII",a="US-ASCII");let g=s?"base64":"ascii",p=unescape(o.substring(r+1)),m=Buffer.from(p,g);return m.type=f,m.typeFull=c,m.charset=a,m}var Zi=tl;var ie=de(require("node:stream"),1),ve=require("node:util"),X=require("node:buffer");Dt();Sr();var Ce=class extends Error{constructor(r,n){super(r),Error.captureStackTrace(this,this.constructor),this.type=n}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};var Y=class extends Ce{constructor(r,n,a){super(r,n),a&&(this.code=this.errno=a.code,this.erroredSysCall=a.syscall)}};var _r=Symbol.toStringTag,En=o=>typeof o=="object"&&typeof o.append=="function"&&typeof o.delete=="function"&&typeof o.get=="function"&&typeof o.getAll=="function"&&typeof o.has=="function"&&typeof o.set=="function"&&typeof o.sort=="function"&&o[_r]==="URLSearchParams",It=o=>o&&typeof o=="object"&&typeof o.arrayBuffer=="function"&&typeof o.type=="string"&&typeof o.stream=="function"&&typeof o.constructor=="function"&&/^(Blob|File)$/.test(o[_r]),lo=o=>typeof o=="object"&&(o[_r]==="AbortSignal"||o[_r]==="EventTarget"),uo=(o,r)=>{let n=new URL(r).hostname,a=new URL(o).hostname;return n===a||n.endsWith(`.${a}`)},fo=(o,r)=>{let n=new URL(r).protocol,a=new URL(o).protocol;return n===a};var bl=(0,ve.promisify)(ie.default.pipeline),Q=Symbol("Body internals"),ge=class{constructor(r,{size:n=0}={}){let a=null;r===null?r=null:En(r)?r=X.Buffer.from(r.toString()):It(r)||X.Buffer.isBuffer(r)||(ve.types.isAnyArrayBuffer(r)?r=X.Buffer.from(r):ArrayBuffer.isView(r)?r=X.Buffer.from(r.buffer,r.byteOffset,r.byteLength):r instanceof ie.default||(r instanceof Ze?(r=so(r),a=r.type.split("=")[1]):r=X.Buffer.from(String(r))));let s=r;X.Buffer.isBuffer(r)?s=ie.default.Readable.from(r):It(r)&&(s=ie.default.Readable.from(r.stream())),this[Q]={body:r,stream:s,boundary:a,disturbed:!1,error:null},this.size=n,r instanceof ie.default&&r.on("error",f=>{let c=f instanceof Ce?f:new Y(`Invalid response body while trying to fetch ${this.url}: ${f.message}`,"system",f);this[Q].error=c})}get body(){return this[Q].stream}get bodyUsed(){return this[Q].disturbed}async arrayBuffer(){let{buffer:r,byteOffset:n,byteLength:a}=await vn(this);return r.slice(n,n+a)}async formData(){let r=this.headers.get("content-type");if(r.startsWith("application/x-www-form-urlencoded")){let a=new Ze,s=new URLSearchParams(await this.text());for(let[f,c]of s)a.append(f,c);return a}let{toFormData:n}=await Promise.resolve().then(()=>(bo(),po));return n(this.body,r)}async blob(){let r=this.headers&&this.headers.get("content-type")||this[Q].body&&this[Q].body.type||"",n=await this.arrayBuffer();return new ke([n],{type:r})}async json(){let r=await this.text();return JSON.parse(r)}async text(){let r=await vn(this);return new TextDecoder().decode(r)}buffer(){return vn(this)}};ge.prototype.buffer=(0,ve.deprecate)(ge.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(ge.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,ve.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});async function vn(o){if(o[Q].disturbed)throw new TypeError(`body used already for: ${o.url}`);if(o[Q].disturbed=!0,o[Q].error)throw o[Q].error;let{body:r}=o;if(r===null)return X.Buffer.alloc(0);if(!(r instanceof ie.default))return X.Buffer.alloc(0);let n=[],a=0;try{for await(let s of r){if(o.size>0&&a+s.length>o.size){let f=new Y(`content size at ${o.url} over limit: ${o.size}`,"max-size");throw r.destroy(f),f}a+=s.length,n.push(s)}}catch(s){throw s instanceof Ce?s:new Y(`Invalid response body while trying to fetch ${o.url}: ${s.message}`,"system",s)}if(r.readableEnded===!0||r._readableState.ended===!0)try{return n.every(s=>typeof s=="string")?X.Buffer.from(n.join("")):X.Buffer.concat(n,a)}catch(s){throw new Y(`Could not create Buffer from response body for ${o.url}: ${s.message}`,"system",s)}else throw new Y(`Premature close of server response while trying to fetch ${o.url}`)}var bt=(o,r)=>{let n,a,{body:s}=o[Q];if(o.bodyUsed)throw new Error("cannot clone body after it is used");return s instanceof ie.default&&typeof s.getBoundary!="function"&&(n=new ie.PassThrough({highWaterMark:r}),a=new ie.PassThrough({highWaterMark:r}),s.pipe(n),s.pipe(a),o[Q].stream=n,s=a),s},gl=(0,ve.deprecate)(o=>o.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),kr=(o,r)=>o===null?null:typeof o=="string"?"text/plain;charset=UTF-8":En(o)?"application/x-www-form-urlencoded;charset=UTF-8":It(o)?o.type||null:X.Buffer.isBuffer(o)||ve.types.isAnyArrayBuffer(o)||ArrayBuffer.isView(o)?null:o instanceof Ze?`multipart/form-data; boundary=${r[Q].boundary}`:o&&typeof o.getBoundary=="function"?`multipart/form-data;boundary=${gl(o)}`:o instanceof ie.default?null:"text/plain;charset=UTF-8",go=o=>{let{body:r}=o[Q];return r===null?0:It(r)?r.size:X.Buffer.isBuffer(r)?r.length:r&&typeof r.getLengthSync=="function"&&r.hasKnownLength&&r.hasKnownLength()?r.getLengthSync():null},yo=async(o,{body:r})=>{r===null?o.end():await bl(r,o)};var Pn=require("node:util"),Wt=de(require("node:http"),1),Cr=typeof Wt.default.validateHeaderName=="function"?Wt.default.validateHeaderName:o=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(o)){let r=new TypeError(`Header name must be a valid HTTP token [${o}]`);throw Object.defineProperty(r,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),r}},An=typeof Wt.default.validateHeaderValue=="function"?Wt.default.validateHeaderValue:(o,r)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(r)){let n=new TypeError(`Invalid character in header content ["${o}"]`);throw Object.defineProperty(n,"code",{value:"ERR_INVALID_CHAR"}),n}},Z=class o extends URLSearchParams{constructor(r){let n=[];if(r instanceof o){let a=r.raw();for(let[s,f]of Object.entries(a))n.push(...f.map(c=>[s,c]))}else if(r!=null)if(typeof r=="object"&&!Pn.types.isBoxedPrimitive(r)){let a=r[Symbol.iterator];if(a==null)n.push(...Object.entries(r));else{if(typeof a!="function")throw new TypeError("Header pairs must be iterable");n=[...r].map(s=>{if(typeof s!="object"||Pn.types.isBoxedPrimitive(s))throw new TypeError("Each header pair must be an iterable object");return[...s]}).map(s=>{if(s.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...s]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return n=n.length>0?n.map(([a,s])=>(Cr(a),An(a,String(s)),[String(a).toLowerCase(),String(s)])):void 0,super(n),new Proxy(this,{get(a,s,f){switch(s){case"append":case"set":return(c,g)=>(Cr(c),An(c,String(g)),URLSearchParams.prototype[s].call(a,String(c).toLowerCase(),String(g)));case"delete":case"has":case"getAll":return c=>(Cr(c),URLSearchParams.prototype[s].call(a,String(c).toLowerCase()));case"keys":return()=>(a.sort(),new Set(URLSearchParams.prototype.keys.call(a)).keys());default:return Reflect.get(a,s,f)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(r){let n=this.getAll(r);if(n.length===0)return null;let a=n.join(", ");return/^content-encoding$/i.test(r)&&(a=a.toLowerCase()),a}forEach(r,n=void 0){for(let a of this.keys())Reflect.apply(r,n,[this.get(a),a,this])}*values(){for(let r of this.keys())yield this.get(r)}*entries(){for(let r of this.keys())yield[r,this.get(r)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((r,n)=>(r[n]=this.getAll(n),r),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((r,n)=>{let a=this.getAll(n);return n==="host"?r[n]=a[0]:r[n]=a.length>1?a:a[0],r},{})}};Object.defineProperties(Z.prototype,["get","entries","forEach","values"].reduce((o,r)=>(o[r]={enumerable:!0},o),{}));function xo(o=[]){return new Z(o.reduce((r,n,a,s)=>(a%2===0&&r.push(s.slice(a,a+2)),r),[]).filter(([r,n])=>{try{return Cr(r),An(r,String(n)),!0}catch{return!1}}))}var yl=new Set([301,302,303,307,308]),vr=o=>yl.has(o);var me=Symbol("Response internals"),oe=class o extends ge{constructor(r=null,n={}){super(r,n);let a=n.status!=null?n.status:200,s=new Z(n.headers);if(r!==null&&!s.has("Content-Type")){let f=kr(r,this);f&&s.append("Content-Type",f)}this[me]={type:"default",url:n.url,status:a,statusText:n.statusText||"",headers:s,counter:n.counter,highWaterMark:n.highWaterMark}}get type(){return this[me].type}get url(){return this[me].url||""}get status(){return this[me].status}get ok(){return this[me].status>=200&&this[me].status<300}get redirected(){return this[me].counter>0}get statusText(){return this[me].statusText}get headers(){return this[me].headers}get highWaterMark(){return this[me].highWaterMark}clone(){return new o(bt(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(r,n=302){if(!vr(n))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new o(null,{headers:{location:new URL(r).toString()},status:n})}static error(){let r=new o(null,{status:0,statusText:""});return r[me].type="error",r}static json(r=void 0,n={}){let a=JSON.stringify(r);if(a===void 0)throw new TypeError("data is not JSON serializable");let s=new Z(n&&n.headers);return s.has("content-type")||s.set("content-type","application/json"),new o(a,{...n,headers:s})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(oe.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});var vo=require("node:url"),Po=require("node:util");var wo=o=>{if(o.search)return o.search;let r=o.href.length-1,n=o.hash||(o.href[r]==="#"?"#":"");return o.href[r-n.length]==="?"?"?":""};var _o=require("node:net");function So(o,r=!1){return o==null||(o=new URL(o),/^(about|blob|data):$/.test(o.protocol))?"no-referrer":(o.username="",o.password="",o.hash="",r&&(o.pathname="",o.search=""),o)}var Ro=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),To="strict-origin-when-cross-origin";function Eo(o){if(!Ro.has(o))throw new TypeError(`Invalid referrerPolicy: ${o}`);return o}function xl(o){if(/^(http|ws)s:$/.test(o.protocol))return!0;let r=o.host.replace(/(^\[)|(]$)/g,""),n=(0,_o.isIP)(r);return n===4&&/^127\./.test(r)||n===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(r)?!0:o.host==="localhost"||o.host.endsWith(".localhost")?!1:o.protocol==="file:"}function gt(o){return/^about:(blank|srcdoc)$/.test(o)||o.protocol==="data:"||/^(blob|filesystem):$/.test(o.protocol)?!0:xl(o)}function ko(o,{referrerURLCallback:r,referrerOriginCallback:n}={}){if(o.referrer==="no-referrer"||o.referrerPolicy==="")return null;let a=o.referrerPolicy;if(o.referrer==="about:client")return"no-referrer";let s=o.referrer,f=So(s),c=So(s,!0);f.toString().length>4096&&(f=c),r&&(f=r(f)),n&&(c=n(c));let g=new URL(o.url);switch(a){case"no-referrer":return"no-referrer";case"origin":return c;case"unsafe-url":return f;case"strict-origin":return gt(f)&&!gt(g)?"no-referrer":c.toString();case"strict-origin-when-cross-origin":return f.origin===g.origin?f:gt(f)&&!gt(g)?"no-referrer":c;case"same-origin":return f.origin===g.origin?f:"no-referrer";case"origin-when-cross-origin":return f.origin===g.origin?f:c;case"no-referrer-when-downgrade":return gt(f)&&!gt(g)?"no-referrer":f;default:throw new TypeError(`Invalid referrerPolicy: ${a}`)}}function Co(o){let r=(o.get("referrer-policy")||"").split(/[,\s]+/),n="";for(let a of r)a&&Ro.has(a)&&(n=a);return n}var N=Symbol("Request internals"),Lt=o=>typeof o=="object"&&typeof o[N]=="object",wl=(0,Po.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),tt=class o extends ge{constructor(r,n={}){let a;if(Lt(r)?a=new URL(r.url):(a=new URL(r),r={}),a.username!==""||a.password!=="")throw new TypeError(`${a} is an url with embedded credentials.`);let s=n.method||r.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(s)&&(s=s.toUpperCase()),!Lt(n)&&"data"in n&&wl(),(n.body!=null||Lt(r)&&r.body!==null)&&(s==="GET"||s==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let f=n.body?n.body:Lt(r)&&r.body!==null?bt(r):null;super(f,{size:n.size||r.size||0});let c=new Z(n.headers||r.headers||{});if(f!==null&&!c.has("Content-Type")){let m=kr(f,this);m&&c.set("Content-Type",m)}let g=Lt(r)?r.signal:null;if("signal"in n&&(g=n.signal),g!=null&&!lo(g))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let p=n.referrer==null?r.referrer:n.referrer;if(p==="")p="no-referrer";else if(p){let m=new URL(p);p=/^about:(\/\/)?client$/.test(m)?"client":m}else p=void 0;this[N]={method:s,redirect:n.redirect||r.redirect||"follow",headers:c,parsedURL:a,signal:g,referrer:p},this.follow=n.follow===void 0?r.follow===void 0?20:r.follow:n.follow,this.compress=n.compress===void 0?r.compress===void 0?!0:r.compress:n.compress,this.counter=n.counter||r.counter||0,this.agent=n.agent||r.agent,this.highWaterMark=n.highWaterMark||r.highWaterMark||16384,this.insecureHTTPParser=n.insecureHTTPParser||r.insecureHTTPParser||!1,this.referrerPolicy=n.referrerPolicy||r.referrerPolicy||""}get method(){return this[N].method}get url(){return(0,vo.format)(this[N].parsedURL)}get headers(){return this[N].headers}get redirect(){return this[N].redirect}get signal(){return this[N].signal}get referrer(){if(this[N].referrer==="no-referrer")return"";if(this[N].referrer==="client")return"about:client";if(this[N].referrer)return this[N].referrer.toString()}get referrerPolicy(){return this[N].referrerPolicy}set referrerPolicy(r){this[N].referrerPolicy=Eo(r)}clone(){return new o(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(tt.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});var Ao=o=>{let{parsedURL:r}=o[N],n=new Z(o[N].headers);n.has("Accept")||n.set("Accept","*/*");let a=null;if(o.body===null&&/^(post|put)$/i.test(o.method)&&(a="0"),o.body!==null){let g=go(o);typeof g=="number"&&!Number.isNaN(g)&&(a=String(g))}a&&n.set("Content-Length",a),o.referrerPolicy===""&&(o.referrerPolicy=To),o.referrer&&o.referrer!=="no-referrer"?o[N].referrer=ko(o):o[N].referrer="no-referrer",o[N].referrer instanceof URL&&n.set("Referer",o.referrer),n.has("User-Agent")||n.set("User-Agent","node-fetch"),o.compress&&!n.has("Accept-Encoding")&&n.set("Accept-Encoding","gzip, deflate, br");let{agent:s}=o;typeof s=="function"&&(s=s(r));let f=wo(r),c={path:r.pathname+f,method:o.method,headers:n[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:o.insecureHTTPParser,agent:s};return{parsedURL:r,options:c}};var Pr=class extends Ce{constructor(r,n="aborted"){super(r,n)}};Sr();kn();var Sl=new Set(["data:","http:","https:"]);async function Ar(o,r){return new Promise((n,a)=>{let s=new tt(o,r),{parsedURL:f,options:c}=Ao(s);if(!Sl.has(f.protocol))throw new TypeError(`node-fetch cannot load ${o}. URL scheme "${f.protocol.replace(/:$/,"")}" is not supported.`);if(f.protocol==="data:"){let y=Zi(s.url),I=new oe(y,{headers:{"Content-Type":y.typeFull}});n(I);return}let g=(f.protocol==="https:"?Fo.default:Bo.default).request,{signal:p}=s,m=null,b=()=>{let y=new Pr("The operation was aborted.");a(y),s.body&&s.body instanceof ee.default.Readable&&s.body.destroy(y),!(!m||!m.body)&&m.body.emit("error",y)};if(p&&p.aborted){b();return}let w=()=>{b(),E()},R=g(f.toString(),c);p&&p.addEventListener("abort",w);let E=()=>{R.abort(),p&&p.removeEventListener("abort",w)};R.on("error",y=>{a(new Y(`request to ${s.url} failed, reason: ${y.message}`,"system",y)),E()}),_l(R,y=>{m&&m.body&&m.body.destroy(y)}),process.version<"v14"&&R.on("socket",y=>{let I;y.prependListener("end",()=>{I=y._eventsCount}),y.prependListener("close",A=>{if(m&&I<y._eventsCount&&!A){let P=new Error("Premature close");P.code="ERR_STREAM_PREMATURE_CLOSE",m.body.emit("error",P)}})}),R.on("response",y=>{R.setTimeout(0);let I=xo(y.rawHeaders);if(vr(y.statusCode)){let F=I.get("Location"),D=null;try{D=F===null?null:new URL(F,s.url)}catch{if(s.redirect!=="manual"){a(new Y(`uri requested responds with an invalid redirect URL: ${F}`,"invalid-redirect")),E();return}}switch(s.redirect){case"error":a(new Y(`uri requested responds with a redirect, redirect mode is set to error: ${s.url}`,"no-redirect")),E();return;case"manual":break;case"follow":{if(D===null)break;if(s.counter>=s.follow){a(new Y(`maximum redirect reached at: ${s.url}`,"max-redirect")),E();return}let O={headers:new Z(s.headers),follow:s.follow,counter:s.counter+1,agent:s.agent,compress:s.compress,method:s.method,body:bt(s),signal:s.signal,size:s.size,referrer:s.referrer,referrerPolicy:s.referrerPolicy};if(!uo(s.url,D)||!fo(s.url,D))for(let ae of["authorization","www-authenticate","cookie","cookie2"])O.headers.delete(ae);if(y.statusCode!==303&&s.body&&r.body instanceof ee.default.Readable){a(new Y("Cannot follow redirect with body being a readable stream","unsupported-redirect")),E();return}(y.statusCode===303||(y.statusCode===301||y.statusCode===302)&&s.method==="POST")&&(O.method="GET",O.body=void 0,O.headers.delete("content-length"));let M=Co(I);M&&(O.referrerPolicy=M),n(Ar(new tt(D,O))),E();return}default:return a(new TypeError(`Redirect option '${s.redirect}' is not a valid value of RequestRedirect`))}}p&&y.once("end",()=>{p.removeEventListener("abort",w)});let A=(0,ee.pipeline)(y,new ee.PassThrough,F=>{F&&a(F)});process.version<"v12.10"&&y.on("aborted",w);let P={url:s.url,status:y.statusCode,statusText:y.statusMessage,headers:I,size:s.size,counter:s.counter,highWaterMark:s.highWaterMark},q=I.get("Content-Encoding");if(!s.compress||s.method==="HEAD"||q===null||y.statusCode===204||y.statusCode===304){m=new oe(A,P),n(m);return}let U={flush:rt.default.Z_SYNC_FLUSH,finishFlush:rt.default.Z_SYNC_FLUSH};if(q==="gzip"||q==="x-gzip"){A=(0,ee.pipeline)(A,rt.default.createGunzip(U),F=>{F&&a(F)}),m=new oe(A,P),n(m);return}if(q==="deflate"||q==="x-deflate"){let F=(0,ee.pipeline)(y,new ee.PassThrough,D=>{D&&a(D)});F.once("data",D=>{(D[0]&15)===8?A=(0,ee.pipeline)(A,rt.default.createInflate(),O=>{O&&a(O)}):A=(0,ee.pipeline)(A,rt.default.createInflateRaw(),O=>{O&&a(O)}),m=new oe(A,P),n(m)}),F.once("end",()=>{m||(m=new oe(A,P),n(m))});return}if(q==="br"){A=(0,ee.pipeline)(A,rt.default.createBrotliDecompress(),F=>{F&&a(F)}),m=new oe(A,P),n(m);return}m=new oe(A,P),n(m)}),yo(R,s).catch(a)})}function _l(o,r){let n=zt.Buffer.from(`0\r
\r
`),a=!1,s=!1,f;o.on("response",c=>{let{headers:g}=c;a=g["transfer-encoding"]==="chunked"&&!g["content-length"]}),o.on("socket",c=>{let g=()=>{if(a&&!s){let m=new Error("Premature close");m.code="ERR_STREAM_PREMATURE_CLOSE",r(m)}},p=m=>{s=zt.Buffer.compare(m.slice(-5),n)===0,!s&&f&&(s=zt.Buffer.compare(f.slice(-3),n.slice(0,3))===0&&zt.Buffer.compare(m.slice(-2),n.slice(3))===0),f=m};c.prependListener("close",g),c.on("data",p),o.on("close",()=>{c.removeListener("close",g),c.removeListener("data",p)})})}var Rl="End-Of-Stream",j=class extends Error{constructor(){super(Rl)}};var Br=class{constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise((r,n)=>{this.reject=n,this.resolve=r})}};var Tl=1*1024*1024,jt=class{constructor(r){if(this.s=r,this.deferred=null,this.endOfStream=!1,this.peekQueue=[],!r.read||!r.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",()=>this.reject(new j)),this.s.once("error",n=>this.reject(n)),this.s.once("close",()=>this.reject(new Error("Stream closed")))}async peek(r,n,a){let s=await this.read(r,n,a);return this.peekQueue.push(r.subarray(n,n+s)),s}async read(r,n,a){if(a===0)return 0;if(this.peekQueue.length===0&&this.endOfStream)throw new j;let s=a,f=0;for(;this.peekQueue.length>0&&s>0;){let c=this.peekQueue.pop();if(!c)throw new Error("peekData should be defined");let g=Math.min(c.length,s);r.set(c.subarray(0,g),n+f),f+=g,s-=g,g<c.length&&this.peekQueue.push(c.subarray(g))}for(;s>0&&!this.endOfStream;){let c=Math.min(s,Tl),g=await this.readFromStream(r,n+f,c);if(f+=g,g<c)break;s-=g}return f}async readFromStream(r,n,a){let s=this.s.read(a);if(s)return r.set(s,n),s.length;{let f={buffer:r,offset:n,length:a,deferred:new Br};return this.deferred=f.deferred,this.s.once("readable",()=>{this.readDeferred(f)}),f.deferred.promise}}readDeferred(r){let n=this.s.read(r.length);n?(r.buffer.set(n,r.offset),r.deferred.resolve(n.length),this.deferred=null):this.s.once("readable",()=>{this.readDeferred(r)})}reject(r){this.endOfStream=!0,this.deferred&&(this.deferred.reject(r),this.deferred=null)}};var Bn=require("node:buffer"),yt=class{constructor(r){this.position=0,this.numBuffer=new Uint8Array(8),this.fileInfo=r||{}}async readToken(r,n=this.position){let a=Bn.Buffer.alloc(r.len);if(await this.readBuffer(a,{position:n})<r.len)throw new j;return r.get(a,0)}async peekToken(r,n=this.position){let a=Bn.Buffer.alloc(r.len);if(await this.peekBuffer(a,{position:n})<r.len)throw new j;return r.get(a,0)}async readNumber(r){if(await this.readBuffer(this.numBuffer,{length:r.len})<r.len)throw new j;return r.get(this.numBuffer,0)}async peekNumber(r){if(await this.peekBuffer(this.numBuffer,{length:r.len})<r.len)throw new j;return r.get(this.numBuffer,0)}async ignore(r){if(this.fileInfo.size!==void 0){let n=this.fileInfo.size-this.position;if(r>n)return this.position+=n,n}return this.position+=r,r}async close(){}normalizeOptions(r,n){if(n&&n.position!==void 0&&n.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return n?{mayBeLess:n.mayBeLess===!0,offset:n.offset?n.offset:0,length:n.length?n.length:r.length-(n.offset?n.offset:0),position:n.position?n.position:this.position}:{mayBeLess:!1,offset:0,length:r.length,position:this.position}}};var El=256e3,Fr=class extends yt{constructor(r,n){super(n),this.streamReader=new jt(r)}async getFileInfo(){return this.fileInfo}async readBuffer(r,n){let a=this.normalizeOptions(r,n),s=a.position-this.position;if(s>0)return await this.ignore(s),this.readBuffer(r,n);if(s<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(a.length===0)return 0;let f=await this.streamReader.read(r,a.offset,a.length);if(this.position+=f,(!n||!n.mayBeLess)&&f<a.length)throw new j;return f}async peekBuffer(r,n){let a=this.normalizeOptions(r,n),s=0;if(a.position){let f=a.position-this.position;if(f>0){let c=new Uint8Array(a.length+f);return s=await this.peekBuffer(c,{mayBeLess:a.mayBeLess}),r.set(c.subarray(f),a.offset),s-f}else if(f<0)throw new Error("Cannot peek from a negative offset in a stream")}if(a.length>0){try{s=await this.streamReader.peek(r,a.offset,a.length)}catch(f){if(n&&n.mayBeLess&&f instanceof j)return 0;throw f}if(!a.mayBeLess&&s<a.length)throw new j}return s}async ignore(r){let n=Math.min(El,r),a=new Uint8Array(n),s=0;for(;s<r;){let f=r-s,c=await this.readBuffer(a,{length:Math.min(n,f)});if(c<0)return c;s+=c}return s}};var Dr=class extends yt{constructor(r,n){super(n),this.uint8Array=r,this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:r.length}async readBuffer(r,n){if(n&&n.position){if(n.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=n.position}let a=await this.peekBuffer(r,n);return this.position+=a,a}async peekBuffer(r,n){let a=this.normalizeOptions(r,n),s=Math.min(this.uint8Array.length-a.position,a.length);if(!a.mayBeLess&&s<a.length)throw new j;return r.set(this.uint8Array.subarray(a.position,a.position+s),a.offset),s}async close(){}};function Do(o,r){return r=r||{},new Fr(o,r)}function Oo(o,r){return new Dr(o,r)}var Ae=require("node:buffer");var qo=de(Io(),1),Wo=require("node:buffer");function G(o){return new DataView(o.buffer,o.byteOffset)}var Lo={len:1,get(o,r){return G(o).getUint8(r)},put(o,r,n){return G(o).setUint8(r,n),r+1}},Or={len:2,get(o,r){return G(o).getUint16(r,!0)},put(o,r,n){return G(o).setUint16(r,n,!0),r+2}},Ir={len:2,get(o,r){return G(o).getUint16(r)},put(o,r,n){return G(o).setUint16(r,n),r+2}};var zo={len:4,get(o,r){return G(o).getUint32(r,!0)},put(o,r,n){return G(o).setUint32(r,n,!0),r+4}},jo={len:4,get(o,r){return G(o).getUint32(r)},put(o,r,n){return G(o).setUint32(r,n),r+4}};var Mo={len:4,get(o,r){return G(o).getInt32(r)},put(o,r,n){return G(o).setInt32(r,n),r+4}};var Uo={len:8,get(o,r){return G(o).getBigUint64(r,!0)},put(o,r,n){return G(o).setBigUint64(r,n,!0),r+8}};var Pe=class{constructor(r,n){this.len=r,this.encoding=n}get(r,n){return Wo.Buffer.from(r).toString(this.encoding,n,n+this.len)}},Dn=class o{constructor(r){this.len=r}static decode(r,n,a){let s="";for(let f=n;f<a;++f)s+=o.codePointToString(o.singleByteDecoder(r[f]));return s}static inRange(r,n,a){return n<=r&&r<=a}static codePointToString(r){return r<=65535?String.fromCharCode(r):(r-=65536,String.fromCharCode((r>>10)+55296,(r&1023)+56320))}static singleByteDecoder(r){if(o.inRange(r,0,127))return r;let n=o.windows1252[r-128];if(n===null)throw Error("invaliding encoding");return n}get(r,n=0){return o.decode(r,n,n+this.len)}};Dn.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];function No(o){return[...o].map(r=>r.charCodeAt(0))}function $o(o,r=0){let n=Number.parseInt(o.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(Number.isNaN(n))return!1;let a=8*32;for(let s=r;s<r+148;s++)a+=o[s];for(let s=r+156;s<r+512;s++)a+=o[s];return n===a}var Ho={get:(o,r)=>o[r+3]&127|o[r+2]<<7|o[r+1]<<14|o[r]<<21,len:4};var Vo=["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","elf","macho","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","j2c","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf","jls","pst","dwg","parquet","class","arj","cpio","ace","avro","icc","fbx"],Yo=["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/wav","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-elf","application/x-mach-binary","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/j2c","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd","image/jls","application/vnd.ms-outlook","image/vnd.dwg","application/x-parquet","application/java-vm","application/x-arj","application/x-cpio","application/x-ace-compressed","application/avro","application/vnd.iccprofile","application/x.autodesk.fbx"];var Qo=4100;async function Go(o){return new On().fromBuffer(o)}function ye(o,r,n){n={offset:0,...n};for(let[a,s]of r.entries())if(n.mask){if(s!==(n.mask[a]&o[a+n.offset]))return!1}else if(s!==o[a+n.offset])return!1;return!0}var On=class{constructor(r){this.detectors=r?.customDetectors,this.fromTokenizer=this.fromTokenizer.bind(this),this.fromBuffer=this.fromBuffer.bind(this),this.parse=this.parse.bind(this)}async fromTokenizer(r){let n=r.position;for(let a of this.detectors||[]){let s=await a(r);if(s)return s;if(n!==r.position)return}return this.parse(r)}async fromBuffer(r){if(!(r instanceof Uint8Array||r instanceof ArrayBuffer))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof r}\``);let n=r instanceof Uint8Array?r:new Uint8Array(r);if(n?.length>1)return this.fromTokenizer(Oo(n))}async fromBlob(r){let n=await r.arrayBuffer();return this.fromBuffer(new Uint8Array(n))}async fromStream(r){let n=await Do(r);try{return await this.fromTokenizer(n)}finally{await n.close()}}async toDetectionStream(r,n={}){let{default:a}=await import("node:stream"),{sampleSize:s=Qo}=n;return new Promise((f,c)=>{r.on("error",c),r.once("readable",()=>{(async()=>{try{let g=new a.PassThrough,p=a.pipeline?a.pipeline(r,g,()=>{}):r.pipe(g),m=r.read(s)??r.read()??Ae.Buffer.alloc(0);try{g.fileType=await this.fromBuffer(m)}catch(b){b instanceof j?g.fileType=void 0:c(b)}f(p)}catch(g){c(g)}})()})})}check(r,n){return ye(this.buffer,r,n)}checkString(r,n){return this.check(No(r),n)}async parse(r){if(this.buffer=Ae.Buffer.alloc(Qo),r.fileInfo.size===void 0&&(r.fileInfo.size=Number.MAX_SAFE_INTEGER),this.tokenizer=r,await r.peekBuffer(this.buffer,{length:12,mayBeLess:!0}),this.check([66,77]))return{ext:"bmp",mime:"image/bmp"};if(this.check([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(this.check([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(this.check([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(this.check([37,33]))return await r.peekBuffer(this.buffer,{length:24,mayBeLess:!0}),this.checkString("PS-Adobe-",{offset:2})&&this.checkString(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(this.check([31,160])||this.check([31,157]))return{ext:"Z",mime:"application/x-compress"};if(this.check([199,113]))return{ext:"cpio",mime:"application/x-cpio"};if(this.check([96,234]))return{ext:"arj",mime:"application/x-arj"};if(this.check([239,187,191]))return this.tokenizer.ignore(3),this.parse(r);if(this.check([71,73,70]))return{ext:"gif",mime:"image/gif"};if(this.check([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(this.check([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(this.check([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(this.checkString("ID3")){await r.ignore(6);let n=await r.readToken(Ho);return r.position+n>r.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await r.ignore(n),this.fromTokenizer(r))}if(this.checkString("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((this.buffer[0]===67||this.buffer[0]===70)&&this.check([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(this.check([255,216,255]))return this.check([247],{offset:3})?{ext:"jls",mime:"image/jls"}:{ext:"jpg",mime:"image/jpeg"};if(this.check([79,98,106,1]))return{ext:"avro",mime:"application/avro"};if(this.checkString("FLIF"))return{ext:"flif",mime:"image/flif"};if(this.checkString("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(this.checkString("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(this.checkString("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(this.checkString("FORM"))return{ext:"aif",mime:"audio/aiff"};if(this.checkString("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(this.check([80,75,3,4])){try{for(;r.position+30<r.fileInfo.size;){await r.readBuffer(this.buffer,{length:30});let n={compressedSize:this.buffer.readUInt32LE(18),uncompressedSize:this.buffer.readUInt32LE(22),filenameLength:this.buffer.readUInt16LE(26),extraFieldLength:this.buffer.readUInt16LE(28)};if(n.filename=await r.readToken(new Pe(n.filenameLength,"utf-8")),await r.ignore(n.extraFieldLength),n.filename==="META-INF/mozilla.rsa")return{ext:"xpi",mime:"application/x-xpinstall"};if(n.filename.endsWith(".rels")||n.filename.endsWith(".xml"))switch(n.filename.split("/")[0]){case"_rels":break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};default:break}if(n.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if(n.filename.startsWith("3D/")&&n.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if(n.filename==="mimetype"&&n.compressedSize===n.uncompressedSize){let a=await r.readToken(new Pe(n.compressedSize,"utf-8"));switch(a=a.trim(),a){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};default:}}if(n.compressedSize===0){let a=-1;for(;a<0&&r.position<r.fileInfo.size;)await r.peekBuffer(this.buffer,{mayBeLess:!0}),a=this.buffer.indexOf("504B0304",0,"hex"),await r.ignore(a>=0?a:this.buffer.length)}else await r.ignore(n.compressedSize)}}catch(n){if(!(n instanceof j))throw n}return{ext:"zip",mime:"application/zip"}}if(this.checkString("OggS")){await r.ignore(28);let n=Ae.Buffer.alloc(8);return await r.readBuffer(n),ye(n,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:ye(n,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:ye(n,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:ye(n,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:ye(n,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:ye(n,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(this.check([80,75])&&(this.buffer[2]===3||this.buffer[2]===5||this.buffer[2]===7)&&(this.buffer[3]===4||this.buffer[3]===6||this.buffer[3]===8))return{ext:"zip",mime:"application/zip"};if(this.checkString("ftyp",{offset:4})&&this.buffer[8]&96){let n=this.buffer.toString("binary",8,12).replace("\0"," ").trim();switch(n){case"avif":case"avis":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return n.startsWith("3g")?n.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(this.checkString("MThd"))return{ext:"mid",mime:"audio/midi"};if(this.checkString("wOFF")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(this.checkString("wOF2")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(this.check([212,195,178,161])||this.check([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(this.checkString("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(this.checkString("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(this.checkString("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(this.check([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(this.checkString("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(this.checkString("%PDF")){try{await r.ignore(1350);let n=10*1024*1024,a=Ae.Buffer.alloc(Math.min(n,r.fileInfo.size));if(await r.readBuffer(a,{mayBeLess:!0}),a.includes(Ae.Buffer.from("AIPrivateData")))return{ext:"ai",mime:"application/postscript"}}catch(n){if(!(n instanceof j))throw n}return{ext:"pdf",mime:"application/pdf"}}if(this.check([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(this.check([73,73])){let n=await this.readTiffHeader(!1);if(n)return n}if(this.check([77,77])){let n=await this.readTiffHeader(!0);if(n)return n}if(this.checkString("MAC "))return{ext:"ape",mime:"audio/ape"};if(this.check([26,69,223,163])){async function n(){let g=await r.peekNumber(Lo),p=128,m=0;for(;!(g&p)&&p!==0;)++m,p>>=1;let b=Ae.Buffer.alloc(m+1);return await r.readBuffer(b),b}async function a(){let g=await n(),p=await n();p[0]^=128>>p.length-1;let m=Math.min(6,p.length);return{id:g.readUIntBE(0,g.length),len:p.readUIntBE(p.length-m,m)}}async function s(g){for(;g>0;){let p=await a();if(p.id===17026)return(await r.readToken(new Pe(p.len,"utf-8"))).replaceAll(/\00.*$/g,"");await r.ignore(p.len),--g}}let f=await a();switch(await s(f.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(this.check([82,73,70,70])){if(this.check([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(this.check([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/wav"};if(this.check([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(this.checkString("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(this.check([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(this.checkString("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(this.checkString("MSCF")||this.checkString("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(this.check([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(this.check([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(this.check([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(this.check([127,69,76,70]))return{ext:"elf",mime:"application/x-elf"};if(this.check([33,66,68,78]))return{ext:"pst",mime:"application/vnd.ms-outlook"};if(this.checkString("PAR1"))return{ext:"parquet",mime:"application/x-parquet"};if(this.check([207,250,237,254]))return{ext:"macho",mime:"application/x-mach-binary"};if(this.check([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(this.checkString("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(this.checkString("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(this.check([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(this.checkString("IMPM"))return{ext:"it",mime:"audio/x-it"};if(this.checkString("-lh0-",{offset:2})||this.checkString("-lh1-",{offset:2})||this.checkString("-lh2-",{offset:2})||this.checkString("-lh3-",{offset:2})||this.checkString("-lh4-",{offset:2})||this.checkString("-lh5-",{offset:2})||this.checkString("-lh6-",{offset:2})||this.checkString("-lh7-",{offset:2})||this.checkString("-lzs-",{offset:2})||this.checkString("-lz4-",{offset:2})||this.checkString("-lz5-",{offset:2})||this.checkString("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(this.check([0,0,1,186])){if(this.check([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(this.check([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(this.checkString("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(this.check([202,254,186,190]))return{ext:"class",mime:"application/java-vm"};if(this.check([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(this.checkString("<?xml "))return{ext:"xml",mime:"application/xml"};if(this.check([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(this.check([82,97,114,33,26,7])&&(this.buffer[6]===0||this.buffer[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(this.checkString("solid "))return{ext:"stl",mime:"model/stl"};if(this.checkString("AC")){let n=this.buffer.toString("binary",2,6);if(n.match("^d*")&&n>=1e3&&n<=1050)return{ext:"dwg",mime:"image/vnd.dwg"}}if(this.checkString("070707"))return{ext:"cpio",mime:"application/x-cpio"};if(this.checkString("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(this.checkString("!<arch>"))return await r.ignore(8),await r.readToken(new Pe(13,"ascii"))==="debian-binary"?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(this.checkString("**ACE",{offset:7})&&(await r.peekBuffer(this.buffer,{length:14,mayBeLess:!0}),this.checkString("**",{offset:12})))return{ext:"ace",mime:"application/x-ace-compressed"};if(this.check([137,80,78,71,13,10,26,10])){await r.ignore(8);async function n(){return{length:await r.readToken(Mo),type:await r.readToken(new Pe(4,"binary"))}}do{let a=await n();if(a.length<0)return;switch(a.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await r.ignore(a.length+4)}}while(r.position+8<r.fileInfo.size);return{ext:"png",mime:"image/png"}}if(this.check([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(this.check([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(this.check([102,114,101,101],{offset:4})||this.check([109,100,97,116],{offset:4})||this.check([109,111,111,118],{offset:4})||this.check([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(this.check([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(this.checkString("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(this.check([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(this.check([48,38,178,117,142,102,207,17,166,217])){async function n(){let a=Ae.Buffer.alloc(16);return await r.readBuffer(a),{id:a,size:Number(await r.readToken(Uo))}}for(await r.ignore(30);r.position+24<r.fileInfo.size;){let a=await n(),s=a.size-24;if(ye(a.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){let f=Ae.Buffer.alloc(16);if(s-=await r.readBuffer(f),ye(f,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(ye(f,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await r.ignore(s)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(this.check([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((this.check([126,16,4])||this.check([126,24,4]))&&this.check([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(this.check([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(this.check([255,79,255,81]))return{ext:"j2c",mime:"image/j2c"};if(this.check([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await r.ignore(20),await r.readToken(new Pe(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(this.check([255,10])||this.check([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(this.check([254,255]))return this.check([0,60,0,63,0,120,0,109,0,108],{offset:2})?{ext:"xml",mime:"application/xml"}:void 0;if(this.check([0,0,1,186])||this.check([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(this.check([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(this.check([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(this.check([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(this.check([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await r.peekBuffer(this.buffer,{length:Math.min(256,r.fileInfo.size),mayBeLess:!0}),this.check([97,99,115,112],{offset:36}))return{ext:"icc",mime:"application/vnd.iccprofile"};if(this.checkString("BEGIN:")){if(this.checkString("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(this.checkString("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(this.checkString("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(this.checkString("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(this.checkString("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(this.check([4,0,0,0])&&this.buffer.length>=16){let n=this.buffer.readUInt32LE(12);if(n>12&&this.buffer.length>=n+16)try{let a=this.buffer.slice(16,n+16).toString();if(JSON.parse(a).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(this.check([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(this.checkString("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(this.check([71])&&this.check([71],{offset:188}))return{ext:"mts",mime:"video/mp2t"};if(this.check([71],{offset:4})&&this.check([71],{offset:196}))return{ext:"mts",mime:"video/mp2t"};if(this.check([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(this.check([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(this.check([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(this.check([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(this.checkString("Kaydara FBX Binary  \0"))return{ext:"fbx",mime:"application/x.autodesk.fbx"};if(this.check([76,80],{offset:34})&&(this.check([0,0,1],{offset:8})||this.check([1,0,2],{offset:8})||this.check([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(this.check([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await r.peekBuffer(this.buffer,{length:Math.min(512,r.fileInfo.size),mayBeLess:!0}),$o(this.buffer))return{ext:"tar",mime:"application/x-tar"};if(this.check([255,254]))return this.check([60,0,63,0,120,0,109,0,108,0],{offset:2})?{ext:"xml",mime:"application/xml"}:this.check([255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0],{offset:2})?{ext:"skp",mime:"application/vnd.sketchup.skp"}:void 0;if(this.checkString("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(this.buffer.length>=2&&this.check([255,224],{offset:0,mask:[255,224]})){if(this.check([16],{offset:1,mask:[22]}))return this.check([8],{offset:1,mask:[8]})?{ext:"aac",mime:"audio/aac"}:{ext:"aac",mime:"audio/aac"};if(this.check([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(this.check([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(this.check([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}async readTiffTag(r){let n=await this.tokenizer.readToken(r?Ir:Or);switch(this.tokenizer.ignore(10),n){case 50341:return{ext:"arw",mime:"image/x-sony-arw"};case 50706:return{ext:"dng",mime:"image/x-adobe-dng"};default:}}async readTiffIFD(r){let n=await this.tokenizer.readToken(r?Ir:Or);for(let a=0;a<n;++a){let s=await this.readTiffTag(r);if(s)return s}}async readTiffHeader(r){let n=(r?Ir:Or).get(this.buffer,2),a=(r?jo:zo).get(this.buffer,4);if(n===42){if(a>=6){if(this.checkString("CR",{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(a>=8&&(this.check([28,0,254,0],{offset:8})||this.check([31,0,11,0],{offset:8})))return{ext:"nef",mime:"image/x-nikon-nef"}}return await this.tokenizer.ignore(a),await this.readTiffIFD(r)??{ext:"tif",mime:"image/tiff"}}if(n===43)return{ext:"tif",mime:"image/tiff"}}};var wf=new Set(Vo),Sf=new Set(Yo);var vl=Object.defineProperty,Pl=Object.defineProperties,Al=Object.getOwnPropertyDescriptors,Jo=Object.getOwnPropertySymbols,Bl=Object.prototype.hasOwnProperty,Fl=Object.prototype.propertyIsEnumerable,Ko=(o,r)=>(r=Symbol[o])?r:Symbol.for("Symbol."+o),Xo=(o,r,n)=>r in o?vl(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,J=(o,r)=>{for(var n in r||(r={}))Bl.call(r,n)&&Xo(o,n,r[n]);if(Jo)for(var n of Jo(r))Fl.call(r,n)&&Xo(o,n,r[n]);return o},Dl=(o,r)=>Pl(o,Al(r)),Ol=(o,r,n)=>(r=o[Ko("asyncIterator")])?r.call(o):(o=o[Ko("iterator")](),r={},n=(a,s)=>(s=o[a])&&(r[a]=f=>new Promise((c,g,p)=>(f=s.call(o,f),p=f.done,Promise.resolve(f.value).then(m=>c({value:m,done:p}),g)))),n("next"),n("return"),r),Zo=async o=>{let r=await Go(o),n=["image/png","image/jpeg","image/webp","image/heic","image/heif","audio/wav","audio/mp3","audio/mpeg","audio/aiff","audio/aac","audio/ogg","audio/flac","video/mp4","video/mpeg","video/mov","video/avi","video/x-flv","video/mpg","video/webm","video/wmv","video/3gpp"],s={"audio/mpeg":"audio/mp3"}[r?.mime]||r?.mime;if(s===void 0||!n.includes(s))throw new Error("Please provide a valid file format that is accepted by Gemini. Learn more about valid formats here: https://ai.google.dev/gemini-api/docs/prompting_with_media?lang=node#supported_file_formats");return s},Il=async(o,r)=>{if(!o.body)throw new Error(await o.text());let n=new TextDecoder("utf-8");try{try{for(var a=Ol(o.body),s,f,c;s=!(f=await a.next()).done;s=!1){let g=f.value;r(JSON.parse(n.decode(g).replace(/^data: /,"")))}}catch(g){c=[g]}finally{try{s&&(f=a.return)&&await f.call(a)}finally{if(c)throw c[0]}}}catch(g){throw new Error(g.stack)}},ea=o=>[{parts:[{text:o[0]}],role:"user"},{parts:[{text:o[1]}],role:"model"}],ql=async({file:o,mimeType:r,gemini:n})=>{let a="https://generativelanguage.googleapis.com";function s(){let w="";for(let R=0;R<2;R++)w=w+Math.random().toString().slice(2);return w}let f=s(),c=(w,R,E)=>new Blob([`--${w}\r
Content-Type: application/json; charset=utf-8\r
\r
${JSON.stringify({file:{mimeType:E}})}\r
--${w}\r
Content-Type: ${E}\r
\r
`,R,`\r
--${w}--`]),g=await n.fetch(`${a}/upload/${n.apiVersion}/files?key=${n.key}`,{method:"POST",headers:{"Content-Type":`multipart/related; boundary=${f}`,"X-Goog-Upload-Protocol":"multipart"},body:c(f,o,r)}).then(w=>w.json());console.log(g);let p=g.file,m=250,b=5e3;for(;;)try{let w=`${a}/${n.apiVersion}/${p.name}?key=${n.key}`,E=await(await n.fetch(w,{method:"GET"})).json();if(E.error)throw new Error(E.error.message);if(E.state==="ACTIVE")break;await new Promise(y=>setTimeout(y,m)),m=Math.min(m*1.5,b)}catch(w){console.error(`An error occurred: ${w.message}`);break}return p.uri},ta=async(o,r)=>{let n=[];for(let a of o)if(typeof a=="string")n.push({text:a});else if(a instanceof ArrayBuffer||a instanceof Uint8Array){let s=await Zo(a);if(s.startsWith("image"))n.push({inline_data:{mime_type:await Zo(a),data:Buffer.from(a).toString("base64")}});else{let f=await ql({file:a,mimeType:s,gemini:r});n.push({fileData:{mime_type:s,fileUri:f}})}}return n},In=class xt{constructor(r,n={}){if(this.getTextObject=s=>s.candidates[0].content.parts[0],this.switchFormat=(s=xt.TEXT)=>f=>{if(f.candidates[0].finishReason==="SAFETY")throw new Error(`Your prompt was blocked by Google. Here are the Harm Categories: 
${JSON.stringify(f.candidates[0].safetyRatings,null,4)}`);switch(s){case xt.TEXT:return this.getTextObject(f).text;case xt.JSON:return f}},this.getText=this.switchFormat(xt.TEXT),this.handleStream=async(s,f,c)=>{let g=this.switchFormat(f),p,m="";return await Il(s,b=>{p=b,m+=this.getText(b),c(g(b))}),this.getTextObject(p).text=m,g(p)},!n.fetch&&typeof fetch!="function")throw new Error("Fetch is not defined globally. Please provide a polyfill. Learn more here: https://github.com/EvanZhouDev/gemini-ai?tab=readme-ov-file#how-to-polyfill-fetch");let a=J(J({},{apiVersion:"v1beta",fetch:typeof fetch=="function"?fetch:n.fetch}),n);this.key=r,this.fetch=a.fetch,this.apiVersion=a.apiVersion}async query(r,n,a){let s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)},f=new URL(`https://generativelanguage.googleapis.com/${this.apiVersion}/models/${r}:${n}`);f.searchParams.append("key",this.key),n==="streamGenerateContent"&&f.searchParams.append("alt","sse");let c=await this.fetch(f.toString(),s);if(!c.ok)throw new Error(`There was an error when fetching Gemini.
${await c.text()}`);return c}async count(r,n={}){let a=J(J({},{model:"gemini-1.5-flash-latest"}),n),s={contents:[{parts:[{text:r}],role:"user"}]};return(await(await this.query(a.model,"countTokens",s)).json()).totalTokens}async embed(r,n={}){let a=J(J({},{model:"embedding-001"}),n),s={model:`models/${a.model}`,content:{parts:[{text:r}],role:"user"}};return(await(await this.query(a.model,"embedContent",s)).json()).embedding.values}async ask(r,n={}){let a=J(J({},{model:"gemini-1.5-flash-latest",temperature:1,topP:.94,topK:32,format:xt.TEXT,maxOutputTokens:2048,data:[],messages:[]}),n),s=a.stream?"streamGenerateContent":"generateContent",f=[...a.messages.flatMap(p=>Array.isArray(p)?ea(p):p)];if(!Array.isArray(r)&&typeof r!="string"){if(r.role==="model")throw new Error("Please prompt with role as 'user'");f.push(r)}else{let p=[r,a.data].flat(),m=await ta(p,this);f.push({parts:m,role:"user"})}let c={contents:f,generationConfig:{temperature:a.temperature,maxOutputTokens:a.maxOutputTokens,topP:a.topP,topK:a.topK}},g=await this.query(a.model,s,c);return a.stream?this.handleStream(g,a.format,a.stream):this.switchFormat(a.format)(await g.json())}createChat(r={}){return new Wl(this,r)}};In.TEXT="text";In.JSON="json";var Mt=In,Wl=class{constructor(o,r){let n=J(J({},{messages:[],temperature:1,topP:.94,topK:1,model:"gemini-1.5-flash-latest",maxOutputTokens:2048}),r);this.gemini=o,this.options=n,this.messages=n.messages.flatMap(ea)}async ask(o,r={}){var n;let a=J(J(J({},this.options),{data:[],format:Mt.TEXT}),r);if(((n=this.messages.at(-1))==null?void 0:n.role)==="user")throw new Error("Gemini has not yet responded to your last message. Please ensure you are running chat commands asynchronously.");try{let s={parts:await ta([o].flat(),this.gemini),role:"user"},f=await this.gemini.ask(s,Dl(J({},a),{format:Mt.JSON,messages:this.messages,stream:a.stream?c=>a.stream(r.format===Mt.JSON?c:c.candidates[0].content.parts[0].text):void 0}));return this.messages.push(s),this.messages.push({parts:f.candidates[0].content.parts,role:"model"}),r.format===Mt.JSON?f:f.candidates[0].content.parts[0].text}catch(s){throw new Error(s)}}},ra=Mt;var qr=de(require("fs")),na=(o,{context:r=void 0,allowPaste:n=!1,useSelected:a=!1,buffer:s=[]})=>{let f={Form:0,Detail:1},{query:c}=o.arguments;c||(c=o.fallbackText??"");let{apiKey:g,defaultModel:p,model:m}=(0,C.getPreferenceValues)();console.log(p,m);let[b,w]=(0,Be.useState)(f.Detail),[R,E]=(0,Be.useState)(""),[y,I]=(0,Be.useState)(!0),[A,P]=(0,Be.useState)(""),[q,U]=(0,Be.useState)(""),[F,D]=(0,Be.useState)(""),O=async(M,ae)=>{U(M),w(f.Detail),await(0,C.showToast)({style:C.Toast.Style.Animated,title:"Waiting for Gemini..."});let se=Date.now(),wt=new ra(g,{fetch:Ar});try{let Fe=await wt.ask(M,{model:m==="default"?p:m,stream:St=>{E(le=>le+St)},data:ae??s});E(Fe),D(Fe),await(0,C.showToast)({style:C.Toast.Style.Success,title:"Response Finished",message:`${(Date.now()-se)/1e3} seconds`})}catch(Fe){Fe.message.includes("429")?(await(0,C.showToast)({style:C.Toast.Style.Failure,title:"You have been rate-limited.",message:"Please slow down."}),E(`## Could not access Gemini.

You have been rate limited. Please slow down and try again later.`)):(await(0,C.showToast)({style:C.Toast.Style.Failure,title:"Response Failed",message:`${(Date.now()-se)/1e3} seconds`}),E(`## Could not access Gemini.

This may be because Gemini has decided that your prompt did not comply with its regulations. Please try another prompt, and if it still does not work, create an issue on GitHub.`)),console.log(Fe)}I(!1)};return(0,Be.useEffect)(()=>{(async()=>{if(r||a)try{let M=await(0,C.getSelectedText)();if(a){c===""?(P(M),w(f.Form)):O(`${c}
${M}`);return}O(`${r}
${M}`)}catch(M){console.error(M),await(0,C.popToRoot)(),await(0,C.showToast)({style:C.Toast.Style.Failure,title:"Could not get the selected text"})}else c===""?w(f.Form):O(c)})()},[]),b===f.Detail?_jsx(C.Detail,{actions:!y&&_jsx(C.ActionPanel,null,n&&_jsx(C.Action.Paste,{content:R}),_jsx(C.Action.CopyToClipboard,{shortcut:C.Keyboard.Shortcut.Common.Copy,content:R}),q&&F&&_jsx(C.Action,{title:"Continue in Chat",icon:C.Icon.Message,shortcut:{modifiers:["cmd"],key:"j"},onAction:async()=>{await(0,C.launchCommand)({name:"aiChat",type:C.LaunchType.UserInitiated,context:{query:q,response:F,creationName:""}})}})),isLoading:y,markdown:R}):_jsx(C.Form,{actions:_jsx(C.ActionPanel,null,_jsx(C.Action.SubmitForm,{onSubmit:M=>{E("");let ae;if(M.files&&(ae=M.files.filter(se=>qr.default.existsSync(se)&&qr.default.lstatSync(se).isFile()).map(se=>qr.default.readFileSync(se))),a){O(`${M.query}
${A}`,ae);return}O(`${r?`${r}

`:""}${M.query}`,ae)}}))},_jsx(C.Form.TextArea,{title:"Prompt",id:"query"}),!s.length&&_jsx(_jsxFragment,null,_jsx(C.Form.Description,{title:"Image",text:"Image that you want Gemini to analyze along with your prompt."}),_jsx(C.Form.FilePicker,{id:"files",title:"",allowMultipleSelection:!1}),_jsx(C.Form.Description,{text:"Note that image data will not be carried over if you continue in Chat."})))};function ia(o){return na(o,{context:"Add comments to the given code. ONLY return the commented code and nothing else.",allowPaste:!0})}
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> *)

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)
*/
